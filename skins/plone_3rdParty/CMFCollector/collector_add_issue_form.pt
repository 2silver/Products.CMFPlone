<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<span tal:condition="nothing"
      tal:define="has_add_priv nocall: here/add_issue">
  This span ensures that the visitor has edit privilege, by fetching - but not
  displaying - the protected collector.add_issue method.
</span>

<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master">

<span tal:condition="nothing">
  Template description: Form for submitting new collector issues.
</span>

<body>

<div metal:fill-slot="header">

<h1>
Add new issue to <span tal:condition="here/Title" tal:replace="here/Title">TITLE</span>
</h1>

<div class="description">
Use this form to add your issue to the Collector. Please provide as many details
as possible.
</div>

</div>

<div metal:fill-slot="main">	  

<div tal:define="pm python: here.portal_membership;
                 member python: pm.getAuthenticatedMember();
                 authenticated python: member.has_role('Authenticated')
                                         or member.has_role('Member')">

<form class="group" 
        method="POST" 
        enctype="multipart/form-data"
        action="collector_add_issue">

    <span class="legend">Submit A New Issue</span> 
    
    <div class="row">
        <div class="label"> Issue Title </div>

        <div class="field">
            <input type="text" name="title" value="" size="40" />
        </div>
    </div>
    
    <div class="row">
        <div class="label">Security</div>
        <div class="field">
            <input type=hidden name="security_related:boolean" value="">
            <input class="noborder" type=checkbox name="security_related:boolean">
            Yes, this issue is security related, and
            should <strong>not</strong> be publicly visible until
            completed.
        </div>
    </div>

    <div class="row">    
        <div class="label"> Submitter </div>

        <div class="field" 
             tal:condition="authenticated"
             tal:content="python: member.getProperty('full_name',
                                                      str(member))">
        </div>

        <div class="field" 
              tal:condition="not: authenticated">
            <input type="text" name="submitter_name" size="30" />
        </div>
    </div>
    
    <div class="row">
        <div class="label"> Email </div>

        <div class="field">
            <input type="text" name="submitter_email" size="30"
                   tal:attributes="value python: member.getProperty('email',
                                                                    '')" />
            <span tal:condition="python: not authenticated and
                                       here.participation != 'anyone'">
                  NOTE that anonymous-submitted issues do not allow submitter
                  to followup.
            </span>

        </div>
    </div>
            
    <div class="row">
        <div class="label"> Topic </div>

        <div class="field">
            <select name="topic">
              <option value=""
                      tal:repeat="it here/topics"
                tal:attributes="value it"
                tal:content="it"></option>
            </select>
        </div>
    </div>
    
    <div class="row">
        <div class="label"> Importance </div>
        
        <div class="field">
         <select name="importance">
           <option value=""
                   tal:repeat="it here/importances"
                   tal:attributes="value it"
                   tal:content="it"></option>
         </select>
        </div>

    </div>

    <div class="row">    
        <div class="label"> Classification </div>
        
        <div class="field">
         <select name="classification">
           <option value=""
                   tal:repeat="it here/classifications"
                   tal:attributes="value it"
                   tal:content="it"></option>
         </select>
        </div>
    
    </div>
    
    <div class="row">
        <div class="label"> Version Info </div>
        <div class="field">
            <textarea name="version_info" rows="3" cols="35"><span tal:replace="here/version_info_spiel"></span></textarea>
            
        </div>
    </div>
    

    <metal:block tal:define="assigner python: pm.checkPermission(
                                              'Support collector issue', here);
                             supporters here/supporters">

    <div class="row">
         <div class="label"> Description </div>
         <div class="field">
           <textarea name="description:text" rows="10" cols="55">Prefix lines with whitespace or '&gt;' to preserve their format.</textarea>
         </div>

    </div>
     
    <div class="row" tal:condition="assigner">
        <div class="label"> Assign to </div> 
        <div class="field">            
           <select name="assignees:list" MULTIPLE size="5"
                   tal:attributes="size python:
                                        min(max(len(supporters), 3), 8)">
             <option tal:repeat="supporter supporters"
                      tal:content="supporter">
               SUPPORTER
             </option>
           </select>
        </div>
    </div>

    </metal:block>
    
    <div class="row">
        <div class="label"> Attachment (optional)</div> 
        <div class="field">
            <input type=file name="file" size="20" />
        </div>
    </div>

    <div class="row">
        <div class="label"> Attachment type (optional)</div>
        <div class="field">
            <input class="noborder" type=radio name="filetype" value="File" checked /> File 
            <input class="noborder" type=radio name="filetype" value="Image" /> Image
        </div>
    </div>
    
    <div class="row">
        <div class="label">Id of upload (optional)</div>
        <div class="field">
            <input type=text name="fileid" size="12" />
        </div>
    </div>
    
    <div class="row">
        <div class="label">&nbsp;</div>
        <div class="field">
         <input class="context" type="submit" value="Submit">
        </div>
    </div>
        
</form>

</div>

</div>

</body>
</html>
