<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      i18n:domain="plone">

<body>
<div metal:define-macro="relatedItems"
    id="relatedItems"
    tal:define="hereTypeInfo python:request.get('this_typeinfo', here.getTypeInfo());
                getInfoFor python:wtool.getInfoFor;
                view_action python:hereTypeInfo.getActionById('view');
                other_action python:hereTypeInfo.getActionById('folderlisting', '');
                isViewTemplate python: template_id==view_action or view_action == 'view' or other_action==template_id;">
    <tal:allowed condition="isViewTemplate">
        <tal:relatedItems tal:define="related python:here.computeRelatedItems();">
            <tal:block tal:condition="python:related">
                <div class="visualClear" />
                <fieldset id="relatedItemBox">
                    <legend i18n:translate="label_related_items">Related item(s)</legend>
                    <ul class="visualNoMarker">
                    <tal:related tal:repeat="item related">
                        <li tal:define="
                                desc                item/Description;
                                item_type item/portal_type;
                                item_type_class python: 'contenttype-' + putils.normalizeString(item_type);
                                item_wf_state       item/review_state|python: getInfoFor(item, 'review_state', '');
                                item_wf_state_class python: 'state-' + putils.normalizeString(item_wf_state);">

                            <span tal:attributes="class item_type_class">
                            <a href="" class=""
                                tal:attributes="href  item/absolute_url;
                                                title item/Description;
                                                class string: $item_wf_state_class visualIconPadding"
                                tal:content="item/title_or_id">
                                Related Item
                            </a>
                            </span>
                        </li>
                    </tal:related>
                    </ul>
                </fieldset>
            </tal:block>
        </tal:relatedItems>
    </tal:allowed>
</div>
</body>
</html>
