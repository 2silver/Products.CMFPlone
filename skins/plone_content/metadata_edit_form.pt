<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<body>

<div metal:fill-slot="main"
     tal:define="Iterator python:modules['Products.CMFPlone'].IndexIterator;
                 tabindex python:Iterator();">

    <h1 i18n:translate="heading_edit_properties">Edit Properties</h1>

    <p i18n:translate="description_edit_properties">
    This information, also referred to as <em>metadata</em> is the collection of information that is used to 
    categorize an object, assign effectuation dates and expiration dates, 
    language, and keywords.
    <br />
    Change this item's metadata using the form below. Remember, metadata is
    powerful - it enables us to do lots of useful categorization. So fill in the fields
    as concisely as possible, and leave the ones you don't know blank.
    </p>


    <form class="group"
          name="edit_form" 
          action="metadata_edit" 
          method="post"
          tal:attributes="action request/URL" >

        <span class="legend" i18n:translate="legend_item_properties">Item Properties</span>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_allow_discussion">Allow Discussion</span>
                <div id="allow_discussion_help" 
                     i18n:translate="help_allow_discussion"
                     class="help" 
                     style="visibility:hidden">
                Specifies whether discussion items and comments can be
                added to this item. "Default" will use the site-wide
                setting for Discussion.
                </div>
            </div>
            
            <div class="field">
	        <metal:block tal:define="val here/isDiscussable;
                                   tabindex tabindex/next;">
                <input class="noborder" 
                       type="radio" 
                       name="allowDiscussion"
                       value="default" 
                       tabindex=""
                       id="discussion_default"
                       onfocus="formtooltip('allow_discussion_help',1)" 
                       onblur="formtooltip('allow_discussion_help',0)" 
		                   tal:attributes="checked python: val == None;
                                       tabindex tabindex;"
                       />
                <label for="discussion_default" i18n:translate="label_discussion_default">Default</label> <br />

                <input class="noborder" 
                       type="radio" 
                       name="allowDiscussion"
                       value="on" 
                       tabindex=""
                       id="discussion_on"
                       onfocus="formtooltip('allow_discussion_help',1)" 
                       onblur="formtooltip('allow_discussion_help',0)" 
                       tal:attributes="checked python: val == 1;
                                       tabindex tabindex;"
                       />
                <label for="discussion_on" i18n:translate="label_discussion_enabled">Enabled</label> <br />

                <input class="noborder" 
                       type="radio" 
                       name="allowDiscussion"
                       value="off" 
                       tabindex=""
                       id="discussion_off"
                       onfocus="formtooltip('allow_discussion_help',1)" 
                       onblur="formtooltip('allow_discussion_help',0)" 
                       tal:attributes="checked python: val == 0;
                                       tabindex tabindex;"
                       />
                <label for="discussion_off" i18n:translate="label_discussion_disabled">Disabled</label>
                       
                       
	        </metal:block>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_keywords">Keywords</span>
    
                <div id="keywords_help" 
                     i18n:translate="help_keywords"
                     class="help" 
                     style="visibility:hidden">
                Here you add the relevant keywords that describe this item. You can either 
                add new ones, or use some of the existing ones. We recommend using the existing
                keywords if possible, try to avoid adding new keywords that are essentially the 
                same as the existing ones.
                <br />
                Each keyword must be on a separate line in the "selected keywords" textbox.
                <br />
                Existing Keywords can be easily changed, but currently is all subjects 
                that have ever been used in the system.
                </div>
            </div>
            <div class="field" 
                  tal:define="global contentSubjects here/Subject;
                              global allowedSubjects python:container.portal_metadata.listAllowedSubjects(here);
                              global previousSubjects python:container.portal_catalog.uniqueValuesFor('Subject');">

                <table>
                    <tr><td>
                    Existing keywords
                    <br />
                        <select id="predefined_subjects"
                                name="predefined_subjects" 
                                size="7" 
                                multiple="multiple"
                                tabindex=""
                                onfocus="formtooltip('keywords_help',1)" 
                                onblur="formtooltip('keywords_help',0)"
                                tal:attributes="tabindex tabindex/next;">
                        <option value="#" tal:repeat="subject python:here.unique(allowedSubjects+previousSubjects)"
                                tal:content="subject" tal:attributes="value subject"> # </option>                                
                        </select>
                        
                        <br />

                        <input class="context" 
                               type="submit" 
                               name="add"
                               tabindex="" 
                               value="Add Selected &gt;"
                               onclick="javascript:addSelectedKeywords();return false;"
                               tal:attributes="tabindex tabindex/next;">

                    <br />
                    New keyword <br />
                    <input type="text" 
                           name="entered_keyword" 
                           value="" 
                           size="20"
                           tabindex=""
                           onfocus="formtooltip('keywords_help',1)" 
                           onblur="formtooltip('keywords_help',0)"
                           tal:attributes="tabindex tabindex/next;"
                           /> 
                    <br />
                    <input class="context" 
                           type="submit" 
                           name="add" 
                           tabindex=""
                           value="Add New &gt;"
                           onclick="javascript:addNewKeyword(document.edit_form.entered_keyword.value);return false;"
                           tal:attributes="tabindex tabindex/next;"
                           />
                    </td>

                    <td>
                    <span i18n:translate="label_selected_keywords">
                    Selected keywords
                    </span>
                    <br />
                    <textarea id="entered_subjects"
                      name="subject:lines" 
                      rows="15" 
                      cols="15" 
                      wrap="off"
                      tabindex=""
                      onfocus="formtooltip('keywords_help',1)" 
                      onblur="formtooltip('keywords_help',0)"
                      tal:attributes="tabindex tabindex/next;"
                      ><span tal:repeat="subject here/Subject" tal:replace="python:str(subject)+'\n'"/></textarea>&nbsp;
                    </td></tr>
                </table>

            </div>

        </div>         

        <div class="row">
            <div class="label">
                <span i18n:translate="label_effective_date">Effective Date</span>

                <div id="effective_date_help" 
                     i18n:translate="help_effective_date"
                     class="help" 
                     style="visibility:hidden">
                The date when the document will be visible when it's published. This way, you can 
                publish a document in advance, but it will not be visible before this date.
                </div>
            </div>
            
            <div class="field"
	               tal:define="inputname  string:effective_date;
                             formname   string:edit_form;
                             inputvalue python:test(here.effective_date, here.effective_date, 'None');
                             onfocus string:formtooltip('effective_date_help',1);
                             onblur string:formtooltip('effective_date_help',0);
                             tabindex tabindex/next;" >
                <div metal:use-macro="here/calendar_support/macros/calendarDatePickerBox">
                    a calendar, hopefully
                </div>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_expiration_date">Expiration Date</span>
                <div id="expiration_date_help" 
                     i18n:translate="help_expiration_date"
                     class="help" 
                     style="visibility:hidden">
                The date when the document expires. This will automatically make the document
                invisible for others at the given date.
                </div>
            </div>

            <div class="field"
	         tal:define="inputname  string:expiration_date;
                             formname   string:edit_form;
                             inputvalue python:test(here.expiration_date, here.expiration_date, 'None');
                             onfocus string:formtooltip('expiration_date_help',1);
                             onblur string:formtooltip('expiration_date_help',0);
                             tabindex tabindex/next;" >
                <div metal:use-macro="here/calendar_support/macros/calendarDatePickerBox">
                    a calendar, hopefully
                </div>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_format">Format</span>
                
                <div id="format_help" 
                     i18n:translate="help_format"
                     class="help" 
                     style="visibility:hidden">
                The MIME-type of the document. If you don't know what this does, just leave it. <br /> Please note that not all content types support all MIME-types. If you select a MIME-type that is not supported by the content type, it will be changed to a generic supported type.
                </div>
            </div>
            
            <div class="field">
                <select name="format" 
			                  value=""
			                  tabindex="" 
			                  onfocus="formtooltip('format_help',1)" 
			                  onblur="formtooltip('format_help',0)"
			                  tal:attributes="value here/Format;
                                        tabindex tabindex/next;">
	            <option value="">Choose MIME-type</option> 
                    <option tal:repeat="mimetype here/plone_utils/availableMIMETypes"
                            tal:attributes="value python:mimetype;
                                            selected python:test(here.Format() == mimetype, 'selected', '');"
                            tal:content="mimetype" />
                </select>
            </div>
        </div>

        <div class="row"
             tal:define="def_language here/portal_properties/default_language;
                         sel_language python:test(here.Language(), here.Language(), def_language);">
            <div class="label">
                <span i18n:translate="label_language">Language</span>
                <div id="language_help" 
                     i18n:translate="help_language"
                     class="help" 
                     style="visibility:hidden">
                The language the document is written in, indicated
                by the ISO-639-2 code.
                </div>
            </div>
            <div class="field">
                <!-- ISO-639-2 language selector for Plone -->
                <select name="language" 
                        tabindex=""
                        value=""
                        onfocus="formtooltip('language_help',1)" 
                        onblur="formtooltip('language_help',0)"
                        tal:attributes="value here/Language;
                                        tabindex tabindex/next;"
                        >
                    <option value="" i18n:translate="choose_language">Choose Language</option> 
	            <option tal:repeat="language here/availableLanguages" 
		            tal:attributes="value python:language[0];
                                            selected python:test(sel_language == language[0], 'selected', '')"
                            tal:content="structure python:language[1]" />
                </select>
            </div>
        </div> 	

        <div class="row">
            <div class="label">
                <span i18n:translate="label_copyrights">Copyrights</span>
                <div id="rights_help" 
                     i18n:translate="help_copyrights"
                     class="help" 
                     style="visibility:hidden">
                Copyright information on the item.
                </div>
            </div>
            
            <div class="field">
                <input type="text" 
                       name="rights" 
                       size="25" 
                       value="" 
                       tabindex=""
                       onfocus="formtooltip('rights_help',1)" 
                       onblur="formtooltip('rights_help',0)"
                       tal:attributes="value here/Rights;
                                       tabindex tabindex/next;"
                       />
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_contributors">Contributors</span>
                <div id="contributors_help" 
                     i18n:translate="help_contributors"
                     class="help" 
                     style="visibility:hidden">
                The names of people that have contributed to this item.
                Each contributor should be on a separate line.
                </div>
            </div>

            <div class="field">
                <textarea name="contributors:lines" 
                          rows="5" 
                          cols="25"
                          tabindex="" 
                          onfocus="formtooltip('contributors_help',1)" 
                          onblur="formtooltip('contributors_help',0)"
                          tal:attributes="tabindex tabindex/next;"
                          ><span tal:repeat="contributor here/Contributors" tal:replace="python:contributor+'\n'">contributor</span></textarea>
            </div>
        </div>

        <div class="row">
            <div class="label">&nbsp;</div>
            <div class="field">
                <input class="context" 
                       type="submit" 
                       tabindex=""
                       name="change_and_view" 
                       value="Save"
                       i18n:attributes="value"
                       tal:attributes="tabindex tabindex/next;"
                       />
            </div>
        </div>	
        
        <span tal:replace="nothing">
        ##### HIDDEN VARIABLES FOR THE FORM_TOOL -- CUT AND PASTE THESE INTO YOUR FORM ####
        </span>
        <input type="hidden" name="form_submitted" value="1" tal:attributes="value template/id" >

    </form>

</div>

</body>

</html>

