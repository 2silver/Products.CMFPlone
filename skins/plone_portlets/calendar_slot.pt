<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">

  <body>

    <!--
      This portlet is now deprecated.  It has been moved to
      portlet_calendar.  The calendar date pickers will remain until
      they are moved to their own macros.
    -->

    <div metal:define-macro="calendarBox"
	 tal:omit-tag=""
	 tal:define="DateTime python:modules['DateTime'].DateTime;
	 current python:DateTime();
	 month python:request.get('month', DateTime().month());
	 year python:request.get('year', DateTime().year());
	 prevMonthTime python:here.getPreviousMonth(month, year);
	 nextMonthTime python:here.getNextMonth(month, year);
	 weeks python:here.portal_calendar.getEventsForCalendar(month=month, year=year);
	 anchor_url request/anchor_url|here/absolute_url;
	 anchor_method request/anchor_method|template/getId;">
      <!-- The calendar, rendered as a table -->

      <table cellspacing="0" class="calendar" id="thecalendar" summary="Calendar" i18n:attributes="summary">
	<thead>
	  <tr>
	    <th id="calendar-previous">
	      <a href="#" tal:attributes="href python:'%s/%s?month:int=%d&amp;year:int=%d' % (anchor_url, anchor_method, prevMonthTime.month(),prevMonthTime.year())">&laquo;</a>
	    </th>
	    <th colspan="5"
		tal:define="date string:$month/1/$year;">
	      <span i18n:translate="" tal:omit-tag="">
		<span i18n:name="monthname">
		  <span i18n:translate=""
			tal:define="monthstring python:DateTime(date).strftime('%B').capitalize();"
			tal:attributes="id string:calendar-month-$monthstring"
			tal:content="string:$monthstring"
		  id="calendar-month-month">&nbsp;</span>
		</span>
		<span i18n:name="year"
		      tal:define="year python:DateTime(date).year()"
		      tal:content="string:$year"
		      tal:attributes="id string:calendar-year-$year;"
		id="calendar-year">&nbsp;</span>
	      </span>
	    </th>
	    <th id="calendar-next">
	      <a href="#" tal:attributes="href python:'%s/%s?month:int=%d&amp;year:int=%d' % (anchor_url, anchor_method, nextMonthTime.month(),nextMonthTime.year())">&raquo;</a>
	    </th>
	  </tr>
	  <tr tal:define="weekdays here/portal_calendar/getDays" class="weekdays">
	    <tal:block repeat="weekday weekdays">
	      <td i18n:translate="" tal:content="weekday">Su</td>
	    </tal:block>
	  </tr>
	</thead>
	<tbody>
	  <tr tal:repeat="week weeks">
	    <tal:block repeat="day week">
	      <tal:block define="daynumber day/day;
			 datestring python: '%d%0.2d%0.2d' % (year, month, daynumber);
			 javascriptstring string:javascript:%sDay('%s');">
		<td class="event" tal:condition="day/event"
		    tal:attributes="onmouseout  python: javascriptstring % ('hide', datestring);
		    onmouseover python: javascriptstring % ('show', datestring);
		    class       python:test(current.year()==year and current.month()==month and current.day()==int(daynumber), 'todayevent', 'event')">
		  <span tal:define="begEndTimes python:here.getBeginAndEndTimes(day=daynumber, month=month, year=year)" tal:omit-tag="">
		    <span tal:define="begin python:DateTime(begEndTimes[0].timeTime()+86400).ISO();
			  end python:DateTime(begEndTimes[1].strftime('%m/%d/%y')).ISO();
			  pss python:modules['Products'].PythonScripts.standard" tal:omit-tag="">
		      <a href="" tal:attributes="href python:utool()+'/search?review_state=published&amp;start:date=%s&amp;start_usage=range:max&amp;end:date=%s&amp;end_usage=range:min'%(pss.url_quote(begin),pss.url_quote(end))">
			<span tal:replace="python: daynumber or default">&nbsp;</span>
		      </a>
		    </span>
		  </span>
		</td>
		<tal:notdayevent tal:condition="not: day/event">
		  <td tal:condition="python: current.year()==year and current.month()==month and current.day()==int(daynumber)"
		      tal:content="python: daynumber or default" class="todaynoevent">
		    &nbsp;
		  </td>
		  <td tal:condition="not: python: current.year()==year and current.month()==month and current.day()==int(daynumber)"
		      tal:content="python: daynumber or default">
		    &nbsp;
		  </td>
		</tal:notdayevent>
	      </tal:block>
	    </tal:block>
	  </tr>
	</tbody>
      </table>


      <!-- The sticky notes -->
      <tal:block repeat="week weeks">
	<tal:block repeat="day week">
	  <div class="dayPopup"
	       id="dummy"
	       tal:attributes="id python:'day%d%0.2d%0.2d' % (year, month, day['day']) "
	       tal:condition="day/event">
	    <div class="date" tal:content="python:here.toPortalTime('%d/%0.2d/%0.2d' % (year, month, day['day']))">
	      2001-04-11
	    </div>
	    <tal:block repeat="anevent day/eventslist">
	      <div class="appointment" tal:content="python: here.getEventString(event=anevent)">an event</div>
	    </tal:block>
	  </div>
	</tal:block>
      </tal:block>

    </div>

    
    <!-- The calendar date picker. -->
    <div metal:define-macro="calendarDatePickerBox" tal:define="
	 tabindex tabindex/next|tabindex|nothing;
	 input_id string:${formname}_${inputname}_${tabindex};
	 values   python:here.date_components_support(inputvalue);
	 days values/days; months values/months; 
     years values/years;
	 minutes values/minutes; 
     hours values/hours;
	 yearStart python:years[0]['value'];
	 yearEnd python:years[-1]['value'];">

      <input type="hidden" tal:attributes="name string:$inputname;
	     id input_id;
	     value inputvalue;" />

      <span>
	<select name="ic_year"
		id="ic_year"
		size="1"
		tal:attributes="tabindex tabindex;
		name string:${inputname}_year;
		id string:${input_id}_year;
		onfocus onfocus|nothing;
		onblur onblur|nothing;
		onchange string:update_date_field('${input_id}','${input_id}_year','${input_id}_month','${input_id}_day','${input_id}_hour','${input_id}_minute');">

	  <option value="year"
		  tal:repeat="year years"
		  tal:attributes="value year/value; selected year/selected"
		  i18n:translate=""
	  tal:content="year/id">year</option>

	</select>
      </span>

      <span i18n:translate="date_separator">/</span>

      <span>
	<select name="ic_month"
		id="ic_month"
		size="1"
		tal:attributes="tabindex tabindex;
		name string:${inputname}_month;
		id string:${input_id}_month;
		onfocus onfocus|nothing;
		onblur onblur|nothing;
		onchange string:update_date_field('${input_id}','${input_id}_year','${input_id}_month','${input_id}_day','${input_id}_hour','${input_id}_minute');">

	  <option value="subj"
		  tal:repeat="month months"
		  tal:attributes="value month/value; selected month/selected"
		  i18n:translate=""
	  tal:content="month/id">month name</option>

	</select>
      </span>

      <span i18n:translate="date_separator">/</span>

      <span>
	<select name="ic_day"
		id="ic_day"
		size="1"
		tal:attributes="tabindex tabindex;
		name string:${inputname}_day;
		id string:${input_id}_day;
		onfocus onfocus|nothing;
		onblur onblur|nothing;
		onchange string:update_date_field('${input_id}','${input_id}_year','${input_id}_month','${input_id}_day','${input_id}_hour','${input_id}_minute');">

	  <option value="subj"
		  tal:repeat="day days"
		  tal:attributes="value day/value; selected day/selected"
		  i18n:translate=""
	  tal:content="day/id">day</option>

	</select>
      </span>

      <a tal:attributes="onclick string:return showJsCalendar('${input_id}_month', '$input_id', '${input_id}_year', '${input_id}_month', '${input_id}_day', '${input_id}_hour', '${input_id}_minute', $yearStart, $yearEnd);"><img tal:replace="structure here/popup_calendar.gif" /></a>

      <span>
	<select name="ic_hour"
		id="ic_hour"
		size="1"
		tal:attributes="tabindex tabindex;
		name string:${inputname}_hour;
		id string:${input_id}_hour;
		onfocus onfocus|nothing;
		onblur onblur|nothing;
		onchange string:update_date_field('${input_id}','${input_id}_year','${input_id}_month','${input_id}_day','${input_id}_hour','${input_id}_minute');">

	  <option value="subj"
		  tal:repeat="hour hours"
		  tal:attributes="value hour/value; selected hour/selected"
		  i18n:translate=""
	  tal:content="hour/id">hour</option>

	</select>
      </span>

      <span i18n:translate="time_separator">:</span>

      <span>
	<select name="ic_minute"
		id="ic_minute"
		size="1"
		tal:attributes="tabindex tabindex;
		name string:${inputname}_minute;
		id string:${input_id}_minute;
		onfocus onfocus|nothing;
		onblur onblur|nothing;
		onchange string:update_date_field('${input_id}','${input_id}_year','${input_id}_month','${input_id}_day','${input_id}_hour','${input_id}_minute');">

	  <option value="subj"
		  tal:repeat="minute minutes"
		  tal:attributes="value minute/value; selected minute/selected"
		  i18n:translate=""
	  tal:content="minute/id">hour</option>

	</select>
      </span>

    </div>

    <div metal:define-macro="calendarDatePickerBoxPopup"
	 class="container"
	 tal:define="DateTime python:modules['DateTime'].DateTime;
	 current python:DateTime();
	 month python:request.get('month', DateTime().month());
	 year python:request.get('year', DateTime().year());
	 prevMonthTime python:here.getPreviousMonth(month, year);
	 nextMonthTime python:here.getNextMonth(month, year);
	 weeks python:here.portal_calendar.getWeeksList(month=month, year=year);
	 input_id string:${formname}_${inputname}_${tabindex};">

      <table cellpadding="2" cellspacing="0" border="0" class="calendar" id="thecalendar">
	<tr tal:define="calendarurl python:'%s?input_id=%s' % (path('template/absolute_url'),input_id) ">
	  <th>
	    <a href="" tal:attributes="href python:'%s&amp;month:int=%d&amp;year:int=%d' % (calendarurl,prevMonthTime.month(),prevMonthTime.year())">&laquo;</a>
	  </th>
	  <th colspan="5" tal:define="date string:$month/1/$year">
	    <span i18n:translate="" tal:omit-tag="">
	      <span i18n:name="monthname">
		<span i18n:translate="" tal:content="python:DateTime(date).strftime('%B').capitalize()" tal:omit-tag="" />
	      </span>
	      <span i18n:name="year" tal:content="python:DateTime(date).year()" tal:omit-tag=""/>
	    </span>
	  </th>

	  <th>
	    <a href="" tal:attributes="href python:'%s&amp;month:int=%d&amp;year:int=%d' % (calendarurl,nextMonthTime.month(),nextMonthTime.year())">&raquo;</a>
	  </th>
	</tr>

	<tr tal:define="weekdays here/portal_calendar/getDays">
	  <tal:block repeat="weekday weekdays">
	    <td class="weekdays" i18n:translate="" tal:content="weekday">Su</td>
	  </tal:block>
	</tr>
	<tr tal:repeat="week weeks">
	  <tal:block define="days week">
	    <tal:block repeat="day days" tal:omit-tag="">
	      <td tal:condition="not: python: day">
		&nbsp;
	      </td>
	      <td class="noevent" tal:condition="python: day"
		  tal:define="datestring python:'%d/%0.2d/%0.2d'%(year,month,day)"
		  tal:attributes="class python:test(current.year()==year and current.month()==month and current.day()==int(day), 'todaynoevent', 'noevent')">
		<a href="" tal:attributes="onclick string:returndate('${datestring}');; return false" tal:content="day">
		  day number
		</a>
	      </td>
	    </tal:block>
	  </tal:block>
	</tr>

      </table>

    </div>
    <!-- end of the calendar datepicker box -->

  </body>

</html>
