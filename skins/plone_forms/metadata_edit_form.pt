<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<body>

<div metal:fill-slot="main">
    <script language="JavaScript"
            src="/calendar.js"
            tal:attributes="src string:${here/portal_url}/calendar.js">
    </script>

    <script language="JavaScript"> 
    function addSelectedKeywords() {
        predefSubjects=document.getElementById('predefined_subjects');
        for (var x=0; x<predefSubjects.length; x++) {
            if (predefSubjects[x].selected) {
                 addNewKeyword(predefSubjects[x].value);
            }
        }
    }

    function addNewKeyword(newWord) {
        selSubjects=document.getElementById('entered_subjects');
        selSubjects.value+=newWord+'\n'
    }
    </script>

    <h1 i18n:translate="">Edit Properties</h1>

    <p i18n:translate="">
    This information, also referred to as <em>metadata</em> is the collection of information that is used to 
    categorize an object, assign effectuation dates and expiration dates, 
    language, and keywords.
    </p>

    <p i18n:translate="">
    Change this item's metadata using the form below. Remember, metadata is
    powerful - it enables us to do lots of useful categorization. So fill in the fields
    as concisely as possible, and leave the ones you don't know blank.
    </p>


    <form class="group"
          name="edit_form" 
          action="metadata_edit" 
          method="post">

        <span class="legend" i18n:translate="">Item Properties</span>

        <div class="row">
            <div class="label">
                <span i18n:id="allow_discussion">Allow Discussion</span>
                <div id="allow_discussion_help" 
                     i18n:id="allow_discussion_help"
                     class="help" 
                     style="visibility:hidden">
                Specifies whether discussion items and comments can be
                added to this item. "Default" will use the site-wide
                setting for Discussion.
                </div>
            </div>
            
            <div class="field">
	        <metal:block tal:define="val here/isDiscussable">
                <input class="noborder" 
                       type="radio" 
                       name="allowDiscussion"
                       value="default" 
                       tabindex="1"
                       id="discussion_default"
                       onfocus="formtooltip('allow_discussion_help',1)" 
                       onblur="formtooltip('allow_discussion_help',0)" 
		               tal:attributes="checked python: val == None"
                       />
                <label for="discussion_default" i18n:id="discussion_default">Default</label> <br />

                <input class="noborder" 
                       type="radio" 
                       name="allowDiscussion"
                       value="on" 
                       tabindex="1"
                       id="discussion_on"
                       onfocus="formtooltip('allow_discussion_help',1)" 
                       onblur="formtooltip('allow_discussion_help',0)" 
                       tal:attributes="checked python: val == 1"
                       />
                <label for="discussion_on" i18n:id="discussion_on">On</label> <br />

                <input class="noborder" 
                       type="radio" 
                       name="allowDiscussion"
                       value="off" 
                       tabindex="1"
                       id="discussion_off"
                       onfocus="formtooltip('allow_discussion_help',1)" 
                       onblur="formtooltip('allow_discussion_help',0)" 
                       tal:attributes="checked python: val == 0"
                       />
                <label for="discussion_off" i18n:id="discussion_off">Off</label>
                       
                       
	        </metal:block>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:id="keywords">Keywords</span>
    
                <div id="keywords_help" 
                     i18n:id="keywords_help"
                     class="help" 
                     style="visibility:hidden">
                Here you add the relevant keywords that describe this item. You can either 
                add new ones, or use some of the existing ones. We recommend using the existing
                keywords if possible, try to avoid adding new keywords that are essentially the 
                same as the existing ones.
                <br />
                Each keyword must be on a separate line in the "selected keywords" textbox.
                <br />
                Existing Keywords can be easily changed, but currently is all subjects 
                that have ever been used in the system.
                </div>
            </div>
            <div class="field" 
                  tal:define="global contentSubjects here/Subject;
                              global allowedSubjects python:container.portal_metadata.listAllowedSubjects(here);
                              global previousSubjects python:container.portal_catalog.uniqueValuesFor('Subject');">

                <table>
                    <tr><td>
                    Existing keywords
                    <br />
                        <select id="predefined_subjects"
                                name="predefined_subjects" 
                                size="7" 
                                multiple="multiple"
                                tabindex="2"
                                onfocus="formtooltip('keywords_help',1)" 
                                onblur="formtooltip('keywords_help',0)">
                        <option value="#" tal:repeat="subject python:here.unique(allowedSubjects+previousSubjects)"
                                tal:content="subject" tal:attributes="value subject"> # </option>                                
                        </select>
                        
                        <br />

                        <input class="context" 
                               type="submit" 
                               name="add"
                               tabindex="3" 
                               value="Add Selected &gt;"
                               onclick="javascript:addSelectedKeywords();return false;">

                    <br />
                    New keyword <br />
                    <input type="text" 
                           name="entered_keyword" 
                           value="" 
                           size="20"
                           tabindex="4"
                           onfocus="formtooltip('keywords_help',1)" 
                           onblur="formtooltip('keywords_help',0)"
                           /> 
                    <br />
                    <input class="context" 
                           type="submit" 
                           name="add" 
                           tabindex="5"
                           value="Add New &gt;"
                           onclick="javascript:addNewKeyword(document.edit_form.entered_keyword.value);return false;"
                           />
                    </td>

                    <td>
                    Selected keywords<br />
                    <textarea id="entered_subjects"
                      name="subject:lines" 
                      rows="15" 
                      cols="15" 
                      wrap="off"
                      tabindex="6"
                      onfocus="formtooltip('keywords_help',1)" 
                      onblur="formtooltip('keywords_help',0)"
                      ><span tal:repeat="subject here/Subject" tal:replace="python:str(subject)+'\n'"/></textarea>&nbsp;
                    </td></tr>
                </table>

            </div>

        </div>         

        <div class="row">
            <div class="label">
                <span i18n:id="effective_date">Effective Date</span>

                <div id="effective_date_help" 
                     i18n:id="effective_date_help"
                     class="help" 
                     style="visibility:hidden">
                The date when the document will be visible when it's published. This way, you can 
                publish a document in advance, but it will not be visible before this date.
                </div>
            </div>
            
            <div class="field"
	         tal:define="inputname  string:effective_date;
                             formname   string:edit_form;
                             inputvalue python:test(here.effective_date, here.effective_date, '');" >
                <div metal:use-macro="here/calendar_support/macros/calendarDatePickerBox">
                    a calendar, hopefully
                </div>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:id="expiration_date">Expiration Date</span>
                <div id="expiration_date_help" 
                     i18n:id="expiration_date_help"
                     class="help" 
                     style="visibility:hidden">
                The date when the document expires. This will automatically make the document
                invisible for others at the given date.
                </div>
            </div>

            <div class="field"
	         tal:define="inputname  string:expiration_date;
                             formname   string:edit_form;
                             inputvalue python:test(here.expiration_date, here.expiration_date, '');" >
                <div metal:use-macro="here/calendar_support/macros/calendarDatePickerBox">
                    a calendar, hopefully
                </div>
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:id="format">Format</span>
                
                <div id="format_help" 
                     i18n:id="format_help"
                     class="help" 
                     style="visibility:hidden">
                The MIME-type of the document. If you don't know what this does, just leave it :)
                </div>
            </div>
            
            <div class="field">
                <input type="text" 
                       name="format" 
                       size="25" 
                       value=""
                       tabindex="11" 
                       onfocus="formtooltip('format_help',1)" 
                       onblur="formtooltip('format_help',0)"
                       tal:attributes="value here/Format"
                       />
                       [pop-up?]
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:id="language">Language</span>
                <div id="language_help" 
                     i18n:id="language_help"
                     class="help" 
                     style="visibility:hidden">
                The language the document is written in, indicated
                by the ISO-639-2 code.
                </div>
            </div>
            <div class="field">
                <!-- ISO-639-2 language selector for Plone -->
                <select name="language" 
                        tabindex="12"
                        value=""
                        onfocus="formtooltip('language_help',1)" 
                        onblur="formtooltip('language_help',0)"
                        tal:attributes="value here/Language"
                        >
                    <option value="">Choose Language</option> 
	            <option tal:repeat="language here/availableLanguages" 
		            tal:attributes="value python:language[0];
                                            selected python:test(here.Language() == language[0], 'selected', '')"
                            tal:content="structure python:language[1]" />
                </select>
            </div>
        </div> 	

        <div class="row">
            <div class="label">
                <span i18n:id="rights">Rights</span>
                <div id="rights_help" 
                     i18n:id="rights_help"
                     class="help" 
                     style="visibility:hidden">
                Copyright information on the item.
                </div>
            </div>
            
            <div class="field">
                <input type="text" 
                       name="rights" 
                       size="25" 
                       value="" 
                       tabindex="13"
                       onfocus="formtooltip('rights_help',1)" 
                       onblur="formtooltip('rights_help',0)"
                       tal:attributes="value here/Rights"
                       />
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:id="contributors">Contributors</span>
                <div id="contributors_help" 
                     i18n:id="contributors_help"
                     class="help" 
                     style="visibility:hidden">
                The names of people that have contributed to this item.
                Each contributor should be on a separate line.
                </div>
            </div>

            <div class="field">
                <textarea name="contributors:lines" 
                          rows="5" 
                          cols="25"
                          tabindex="14" 
                          onfocus="formtooltip('contributors_help',1)" 
                          onblur="formtooltip('contributors_help',0)"
                          ><span tal:repeat="contributor here/Contributors" tal:replace="python:contributor+'\n'">contributor</span></textarea>
            </div>
        </div>

        <div class="row">
            <div class="label">&nbsp;</div>
            <div class="field">
                <input class="context" 
                       type="submit" 
                       tabindex="15"
                       name="change_and_view" 
                       value="Save"
                       />
            </div>
        </div>	

    </form>

</div>

</body>

</html>

