<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<body>

<div metal:fill-slot="main" 
     tal:define="rejection here/rejectAnonymous">

    
    <script language="JavaScript"> 
    function submitFormAction(folderAction) {
        document.edit_form.action = document.edit_form.action+'/'+folderAction;
        document.edit_form.submit();
    }

    function addSelectedKeywords() {
        predefSubjects=document.getElementById('predefined_keywords');
        for (var x=0; x<predefSubjects.length; x++) {
            if (predefSubjects[x].selected) {
                 addNewKeyword(predefSubjects[x].value);
            }
        }
    }

    function addNewKeyword(newWord) {
        selSubjects=document.getElementById('selected_keywords');
        selSubjects.value+=newWord+'\n'
    }
    </script>

    <h1>Edit Properties</h1>

    <p>
    This information, also referred to as <em>metadata</em> is the collection of information that is used to 
    categorize an object, assign effectuation dates and expiration dates, 
    language, and keywords.
    </p>

    <p>
    Change this item's metadata using the form below. Remember, metadata is
    powerful - it enables us to do lots of nifty stuff. So fill in the fields
    as concisely as possible, and leave the ones you don't know blank.
    </p>

    <p>
    More metadata are available, but these are the most commonly used. To edit
    all of them, use the <a href="full_metadata_edit_form" tal:attributes="href string:${here/getId}/full_metadata_edit_form" >full metadata form</a>.
    </p>

    <form class="group"
          name="edit_form" 
          action="metadata_edit" 
          method="post"
          tal:attributes="action string:${here/getId}/metadata_edit">

        <span class="legend">Item Information</span>

        <div class="row">
            <span class="label">Title</span>
            <span class="field"> 
                  <input type="text" name="title"
                     value="My Page" size="25"
                     tal:attributes="value here/Title"> 
            </span>
            <span class="info">The title of the item.</span>
        </div>

        <div class="row">
            <span class="label">Description</span>
            <span class="field">
                <textarea name="description:text" rows="10" cols="25"
                          tal:content="here/Description">Some descriptive text</textarea>
            </span>
            <span class="info">A short description of the item.</span>
        </div>

        <div class="row">
            <span class="label">Allow Discussion</span>
            <span class="field">
             <select name="allowDiscussion"
                     tal:define="val here/isDiscussable">
               <option value="None"
                       tal:attributes="selected python: val == None"> Default </option>
               <option value="0"
                       tal:attributes="selected python: val == 0"> Off </option>
               <option value="1"
                       tal:attributes="selected python: val == 1"> On </option>
             </select>
            </span>
            <span class="info"></span>
        </div>
        
        <div class="row">
            <span class="label">Keywords</span>
            <span class="field" 
                  tal:define="global contentSubjects here/Subject;
                              global allowedSubjects python:container.portal_metadata.listAllowedSubjects(here);
                              global previousSubjects python:container.portal_catalog.uniqueValuesFor('Subject');">

                <table>
                    <tr><td>
                    New keyword <br />
                    <input type="text" name="entered_keyword" value="" size="15"> 
                    <input class="context" type="submit" name="add" value="Add &gt;"
                           onclick="javascript:addNewKeyword(document.edit_form.entered_keyword.value);return false;">
                    <br />            
                    Existing keywords
                    <br />
                        <select id="predefined_keywords" name="predefined_subjects" size="7" multiple="multiple" >
                        <option value="#" tal:repeat="subject python:here.unique(allowedSubjects+previousSubjects)"
                                tal:content="subject" tal:attributes="value subject"> # </option>                                
                        </select>
                        <input class="context" type="submit" name="add" value="Add &gt;"
                               onclick="javascript:addSelectedKeywords();return false;">
                    </td>
    
                    <td>
                    Selected keywords<br />
                    <textarea id="selected_keywords" name="subject:lines" rows="10" cols="10" wrap="OFF"><span tal:repeat="subject here/Subject" tal:replace="python:str(subject)+'\n'"/></textarea>&nbsp;
                    </td></tr>
                </table>

            </span>

            <span class="info">
            Here you add the relevant keywords that describes this item. You can either 
            add new ones, or use some of the existing ones. We recommend using the existing
            keywords if possible, try to avoid adding new keywords that are essentially the 
            same as the existing ones.
            <br />
            Each keyword must be on a separate line in the "selected keywords" textbox.
            <br />
            Existing Keywords can be easily changed, but currently is all subjects 
            that have ever been used in the system.
            </span>

        </div>         

        <input type="hidden" name="format" value="#" tal:attributes="value here/Format" />

        <br /> 

        <div class="row">
            <span class="label">&nbsp;</span>
            <span class="field" tal:define="process_creation python:test(request['HTTP_REFERER'].find('folder_factories'), 1, 0);">
                <input type="hidden" name="process_creation" value="1" tal:condition="process_creation" />
                <input class="context" type="submit" name="change_and_view" value="Save" />
                <input class="context" type="submit" name="cancel_edit:method" value="Cancel Creation" tal:condition="process_creation" />
            </span>

            <span class="info"></span>
        </div>	

    </form>

</div>

</body>

</html>

