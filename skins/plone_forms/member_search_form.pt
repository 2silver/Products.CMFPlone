<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

    <metal:block fill-slot="base">
        <tal:block tal:define="dummy python:request.set('disable_border', 1)"
                   tal:replace="nothing">
        Disable the tabs
        </tal:block>
    </metal:block>

<body>

<div metal:fill-slot="main"
     tal:define="Iterator python:modules['Products.CMFPlone'].IndexIterator;
                 tabindex python:Iterator();
                 is_manager python:test(here.portal_membership.checkPermission('Manage portal', here), 1, 0);
                 ">

    <h1 i18n:translate="heading_advanced_search">Search for members</h1>
    
    <p i18n:translate="description_advanced_search">
    This search form enables you to find members by specifying one or more 
    search criteria. 
    </p>
  
  	<form class="group"
          action="member_search_results" 
          method="post" 
          name="search" 
          tal:define="DateTime python:modules['DateTime'].DateTime">

        <span class="legend" i18n:translate="legend_search_terms">Member Search Criteria</span>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_name">Name</span>
                <div id="name_search_help"
                     i18n:translate="help_search_name" 
                     class="help" 
                     style="visibility:hidden">
                Return members with login names containing this value.
                </div>
            </div>
            
            <div class="field">
                <input type="text" 
                       name="name" 
                       size="25" 
                       tabindex=""
                       onfocus="formtooltip('name_search_help',1)" 
                       onblur="formtooltip('name_search_help',0)"
                       tal:attributes="tabindex tabindex/next;" 
                       />
            </div>
        </div>

        <div class="row">
            <div class="label">
                <span i18n:translate="label_email">Email</span>
                <div id="email_search_help"
                     i18n:translate="help_search_email" 
                     class="help" 
                     style="visibility:hidden">
                Return members with email addresses containing this value.
                </div>
            </div>
            
            <div class="field">
                <input type="text" 
                       name="email" 
                       size="25" 
                       tabindex=""
                       onfocus="formtooltip('email_search_help',1)" 
                       onblur="formtooltip('email_search_help',0)"
                       tal:attributes="tabindex tabindex/next;" 
                       />
            </div>
        </div>
  

        <div class="row">
            <div class="label">
                <span i18n:translate="label_last_login_since">Logged in since</span>
                <div id="last_login_since_search_help"
                     i18n:translate="help_search_last_login_since" 
                     class="help" 
                     style="visibility:hidden">
                Return members who have logged in since yesterday, last week, etc.
                </div>
            </div>
	
            <div class="field">
            
                <span tal:define="today python:DateTime().earliestTime()">
                
                    <select name="last_login_time:date"
                            tabindex=""
                            onfocus="formtooltip('last_login_since_search_help',1)" 
                            onblur="formtooltip('last_login_since_search_help',0)"
                            tal:attributes="tabindex tabindex/next;" 
                            tal:define="yesterday python:(today-1).Date();
                                        lastweek python:(today-7).Date();
                                        lastmonth python:(today-31).Date();
                                        ever string:1970/02/01 00:00:00 GMT;">
                        <option value="#" tal:attributes="value yesterday" i18n:translate="time_yesterday"> Yesterday </option>
                        <option value="#" tal:attributes="value lastweek" i18n:translate="time_last_week"> Last week </option>
                        <option value="#" tal:attributes="value lastmonth" i18n:translate="time_last_month"> Last month </option>
                        <option value="#" tal:attributes="value ever" selected="selected" i18n:translate="time_ever"> Ever </option>
                    </select>
                
                </span>
                <input type="hidden" name="last_login_usage" value="range:min" /> 
            </div>
        </div>
        
        <div class="row" tal:condition="is_manager">
            <div class="label">
                <span i18n:translate="label_roles">Roles</span>
                <div id="roles_search_help"
                     i18n:translate="help_search_roles" 
                     class="help" 
                     style="visibility:hidden">
                Return members with all of the selected roles.
                Multiple roles may be selected
                by pressing <strong>Ctrl</strong> while 
                <strong>left clicking</strong> the roles.
                </div>
            </div>
            
            <div class="field"
                  tal:define="memberRoles request/roles|nothing;
                              portalRoles python:here.portal_membership.getPortalRoles()">
            
                <select name="roles:list" 
                        size="6" 
                        multiple="multiple"
                        tabindex=""
                        onfocus="formtooltip('roles_search_help',1)" 
                        onblur="formtooltip('roles_search_help',0)"
                        tal:attributes="tabindex tabindex/next;" 
                        >
                    <option value="#"
                            tal:repeat="role portalRoles"
                            tal:content="role"
                  			    tal:attributes="value role">dummy</option>
                </select>
                
            </div>
        </div>

        <div class="row">
            <div class="label">&nbsp;</div>
            <div class="field">
                <input class="context" 
                       tabindex=""
                       type="submit" 
                       name="submit" 
                       value="Search"
                       i18n:attributes="value" 
                       tal:attributes="tabindex tabindex/next;"
                       />
            </div>
        </div>

    </form>
	
</div>
	   
</body>
</html>
