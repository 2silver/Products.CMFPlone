<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<div tal:condition="exists: here/portal_skins | nothing"
     tal:replace="nothing">

    <div tal:condition="here/portal_skins/updateSkinCookie | nothing"
       tal:define="dummy here/setupCurrentSkin">
    </div>

</div>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone"      i18n:domain="plone"
>

<body>

<div metal:fill-slot="main"
     tal:define="Iterator python:modules['Products.CMFPlone'].IndexIterator;
                 tabindex python:Iterator();">

    <div tal:define="p_props here/portal_properties">
		
        <div tal:condition="here/portal_membership/isAnonymousUser | nothing">
		
            <span tal:define="dummy python: request['RESPONSE'].expireCookie('__ac', path='/')">
            </span>
		
            <h1 i18n:translate="">Sign-in failure</h1>
            
            <p>
            <span i18n:translate="">
            You are not currently signed in.  Your user name and/or password may be incorrect.
            Your browser may also not be configured to accept HTTP cookies.  
            If you need help please contact
            </span>
            
            <a href="mailto:admin@here.com" title="Email Administrator"
            tal:attributes="href string:mailto:${p_props/email_from_address}"
            tal:content="p_props/email_from_name">
            Email Admin
            </a>.
            </p>
		
        </div>
		
        <div tal:condition="python: not(here.portal_membership.isAnonymousUser())"
             tal:define="member python: here.portal_membership.getAuthenticatedMember()">

             <div tal:condition="python:member.getProperty('login_time', None) == '2000/01/01' and p_props.validate_email">

		<metal:block tal:on-error="nothing"
		             tal:define="dum_reg python: member.setProperties(last_login_time=here.ZopeTime(),login_time=here.ZopeTime())" />

                <h1 i18n:translate="">Welcome!</h1>
                
                <p>
                <span i18n:translate="">
                This is the first time that you've logged in to 
                </span>
                
                <span replace="p_props/title">Here</span>. 
                
                <span i18n:translate="">
                Before you start exploring you need to change your original password. 
                This will ensure that the password we sent you via email cannot be used in a malicious manner.
                </span>
                </p>
                
                <p i18n:translate="">
                Please use the form below to change your password.
                </p>
				
                <form class="group"
                      action="change_password"
                      name="change_password" 
                      method="post"
                      tal:attributes="action python: container.portal_url()+'/change_password'">

                    <span class="legend" i18n:translate="">Password Details</span>
                                    
                    <input type="hidden" 
                           name="came_from" 
                           value=""
                           tal:define="came_from request/came_from|nothing"
                           tal:condition="came_from"
                           tal:attributes="value came_from" 
                           />
                           
               
                    <div class="row">
                        <div class="label">
                            <span i18n:id="new_password">New password</span>
                            <div id="new_password_help"
                                 i18n:id="new_password_help" 
                                 class="help" 
                                 style="visibility:hidden">
                            Enter your new password. Minimum 5 characters.
                            </div>                
                            
                        </div>
                        <div class="field"> 
                            <input type="password" 
                                   name="password" 
                                   size="10"
                                   tabindex=""
                                   onfocus="formtooltip('new_password_help',1)" 
                                   onblur="formtooltip('new_password_help',0)"
                                   tal:attributes="tabindex tabindex/next;" 
                                   />
                        </div>
                    </div>
            
                    <div class="row">
                        <div class="label">
                            <span i18n:id="confirm_password">Confirm password</span>
                            <div id="confirm_password_help" 
                                 i18n:id="confirm_password_help"
                                 class="help" 
                                 style="visibility:hidden">
                            Re-enter the password. Make sure the passwords are identical.
                            </div>
                            
                        </div>
                        <div class="field"> 
                            <input type="password" 
                                   name="confirm" 
                                   size="10"
                                   tabindex=""
                                   onfocus="formtooltip('confirm_password_help',1)" 
                                   onblur="formtooltip('confirm_password_help',0)"
                                   tal:attributes="tabindex tabindex/next;" 
                                   />
                        </div>
                    </div>

                    <div class="row">
                        <div class="label"></div>
                        <div class="field">
                            <input type="submit" 
                                   name="submit" 
                                   value="Change Password"
                                   tabindex=""
                                   tal:attributes="tabindex tabindex/next;">
                        </div>
                    </div>

                </form>
			
            </div>
			
            
             <div tal:condition="python: not(member.login_time == here.ZopeTime('2000/01/01') and here.validate_email)">
                <metal:block tal:on-error="nothing"
		     tal:define="d_reg python: member.setProperties(last_login_time=member.login_time); 
                                 ereg python: member.setProperties(login_time=here.ZopeTime());
                                 global actions python: here.portal_actions.listFilteredActionsFor(here);">
                </metal:block>
				
                <div tal:condition="request/came_from | nothing ">
                    <div tal:define="dummy python: request.RESPONSE.redirect(request.get('came_from'))">
                    </div>
                </div>

                <h1 i18n:translate="">You are now logged in</h1>
                
                <p>
                [<a href="" tal:attributes="href request/HTTP_REFERER">back to where you came from</a>]
                </p>
                
                <p i18n:translate="">
                You will notice that the top right bar has changed, it now
                contains several personalized items. These will stay there
                as long as you are logged in, and allow you to control your
                settings and your personal area.
                </p>
                
                <p>
                <span i18n:translate="">
                You might want to head over to
                </span>

                <a href="metadata_form" 
                   tal:define="mystuff python:here.getActionUrlById('my stuff', actions['user']);"
                   tal:condition="mystuff" tal:attributes="href mystuff"
                   >My Stuff</a>
                
                <span i18n:translate="">
                and add some content, or
                </span>
                 
                <a href="metadata_form" 
                   tal:define="prefs python:here.getActionUrlById('preferences', actions['user']);"
                   tal:condition="prefs" 
                   tal:attributes="href prefs"
                   >set up your Preferences</a>.
		        
                
                <p>
                We wish you a pleasant stay here.
                If you have any questions or comments, visit the 
                <a href="help">Help section</a> or
                <a href="mailto:admin@here.com" title="Email Admin"
                tal:attributes="href string:mailto:${p_props/email_from_address}">
                send us a mail</a>.
                </p>	 
			</div>

		</div>

	</div>

</div>

</body>
</html>

