<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<tal:block metal:fill-slot="head_slot">
   <tal:block tal:define="dummy python:request.set('disable_border',1)" />
</tal:block>

<body>

<div metal:fill-slot="main"
     tal:define="userid python:request.get('userid', member.getId());
                user python:mtool.getMemberById(userid);
                mdata here/portal_memberdata;
                errors python:request.get('errors', {});
                Batch python:modules['ZTUtils'].Batch;
                b_start python:request.get('b_start',0);"
     tal:condition="here/rejectAnonymous" >

<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->
<ul id="contentTabs"> 
  <li class="selected">
    <a href=""
       tal:attributes="href string:${template/id}?userid=${userid}"
    >User</a>
  </li>
  <li class="">
    <a href=""
       tal:attributes="href string: prefs_user_memberships?userid=${userid}"
    >Group Membership</a>
  </li>
</ul>
<div id="contentBar">&nbsp;</div>
<!-- End of tabs -->

<div class="document editable">

    <h1 i18n:translate="">User Properties for <span tal:replace="user/getId | default">#unavailable#</span></h1>

    <p i18n:translate="">
    Change member properties.
    </p>

    <form class="group"
          action=""
          name="users"
          method="post"
          tal:condition="user | nothing"
          tal:attributes="action string:${here/portal_memberdata/absolute_url}"
          tal:define="portal_users python: here.portal_membership.listMembers();
                      batch python:Batch(portal_users, 25, int(b_start), orphan=1);
                      targetobject mdata;
                      targetGetProperty nocall:user/getProperty | nothing;">

        <span class="legend">User Properties</span>

        <div class="portrait" style="float: right;"
             tal:define="portrait python: here.portal_membership.getPersonalPortrait(user.getId());">
            <img src="" alt="" 
                 tal:attributes="src portrait/absolute_url" />     
        </div>

        <input type="hidden" name="userid" value="username" 
               tal:attributes="value user/getId" />

         <tal:set tal:condition="targetobject/management_page_charset|nothing"
                  tal:define="dummy python:request.set('management_page_charset_tag','')" />

         <tal:set tal:condition="not:targetobject/management_page_charset|nothing">
            <tal:defines define="dummy python:request.set('management_page_charset','UTF-8');
                                 dummy python:request.set('management_page_charset_tag','UTF-8:');" />
         </tal:set>

        <tal:properties repeat="property targetobject/propertyMap">
        
          <div class="row">

          <label for="value" 
                 tal:define="global id property/id;
                             global type property/type;
                             global propertyvalue python:targetGetProperty(id, None);"
                 tal:attributes="for id"
                 tal:content="python:targetobject.propertyLabel(id)">Property Value</label>

          
              <div class="field"
                   tal:define="propertyitem python:targetobject.getProperty(id)"
               tal:condition="python:'w' in property.get('mode', 'awd')">
               
               <input type="text" name="id" size="35"
                      tal:condition="python:type in ('int', 'long')"
                      tal:attributes="name string:$id:$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />
           
               <input type="text" name="id" size="35"
                      tal:condition="python:type in ('float','date')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />
 
               <input type="text" name="string and ustring" size="35"
                      tal:condition="python:type in ('string','ustring')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />
               
               <input type="checkbox" 
                      class="noborder"
                      name="id" 
                      id="cb-checkbox"
                      tal:condition="python: type in ('boolean',)"
                      tal:attributes="name string:$id:$type;
                                      id string:cb-$id;
                                      checked python:test(propertyvalue, 'checked', '')" />

               <input name="tokens and utokens" value="" type="text" size="35"
                      tal:condition="python:type in ('tokens', 'utokens')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />

               <textarea name="text and utext" 
                      rows="6" 
                      cols="35"
                      tal:condition="python: type in ('text', 'utext')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type"
                      tal:content="propertyvalue">some data</textarea>

               <textarea name="lines and ulines" 
                      rows="6" 
                      cols="35"
                      tal:condition="python: type in ('lines', 'ulines')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;"
                      tal:content="propertyvalue"><tal:content 
                tal:repeat="line propertyvalue"><span tal:replace="string:line\n"/></tal:content>
                </textarea>   


                <tal:selections tal:condition="python:type in ('selection', 'multiple selection')"
                                tal:define="select_variable python:property.get('select_variable','')">

                <tal:define condition="select_variable"
                            define="global select_value python:path('here/%s' %select_variable);" />

                <select name="selection" tal:condition="python:type in ('selection',)"
                    tal:attributes="name string:$id:${request/management_page_charset_tag}text">
                    <tal:values repeat="option select_value">
                        <option tal:attributes="SELECTED python:test(propertyvalue==option,'SELECTED','')"
                            tal:content="option">value</option>
                    </tal:values>
                </select>

                <select name="multiple selection" multiple tal:condition="python:type in ('multiple selection',)"
                        tal:attributes="name string:$id:${request/management_page_charset_tag}list:string;
                                        size python:min(7, len(select_value));">
                    <tal:values repeat="option select_value">
                        <option tal:attributes="SELECTED python:test(propertyvalue and option in propertyvalue,
                                                                    'selected', '')"
                                tal:content="option">value</option>
                    </tal:values>
                </select>
    
                </tal:selections>
    
              </div>
              
            </div>

        </tal:properties>

        <input class="context"
               type="submit" 
               name="prefs_user_edit:method" 
               value="Save" />
    </form>

</div>
    
</div>

</body>
</html>

