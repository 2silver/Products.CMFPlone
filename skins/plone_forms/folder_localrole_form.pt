<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
      
<body>

  <div metal:fill-slot="main"
       tal:define="join python:modules['string'].join;
                   Iterator python:modules['Products.CMFPlone'].IndexIterator;
                   tabindex python:Iterator();
                   search_submitted request/role_submit|nothing;
                   search_results python:test(search_submitted, here.portal_membership.searchMembers( search_param=request.get('search_param','')
                                                                                                    , search_term=request.get('search_term', '') ), None);"
       >

    <metal:block tal:condition="python:test(search_submitted and not search_results, 1, 0)">
		    <h1 i18n:translate="heading_search_results">Search results</h1>
		    <p i18n:translate="no_members_found">No members were found using your <strong>Search Criteria</strong></p>
		    <hr />
    </metal:block>
    
    <metal:block tal:condition="python:test(search_submitted and search_results, 1, 0)">
    
		    <h1 i18n:translate="heading_search_results">Search results</h1>

		    <p i18n:translate="description_localrole_select_member">Select one or more Members, and a role to assign.</p>
	
	      <form class="group"
              method="post" 
              name="change_type" 
              action="folder_localrole_edit">
 		
            <span class="legend" i18n:translate="legend_available_members">Available Members</span>
                
            <input type="hidden" name="change_type" value="add" />
    		
    		    <span class="card" tal:repeat="member search_results">
    				
        				<img src="defaultUser.gif" alt="Blank Picture" /> <br />
        				
        				<input class="noborder" 
                               type="checkbox"
                               name="member_ids:list" 
                               value=""
                               tabindex=""
                               tal:attributes="value member/username;
                                               tabindex tabindex/next;"
                       />
        				<br />
        				
        				<strong tal:condition="python:member['username']"
                        tal:content="python:member['username']">
        				username
        				</strong>
        
        				<br />
        				
        				<span tal:condition="python:member['email']"
                              tal:replace="python:member['email']">
        				email
        				</span>						    
        		        
                <span tal:condition="python:not member['email']">&nbsp;</span>
    		    </span>
    		
    		
        		<div class="row">
        				
          			<div class="label" i18n:translate="label_localrole_to_assign">
          			Role to assign
          			</div>
        
                <div class="field">
                    <select name="member_role"
                            tabindex=""
                            tal:attributes="tabindex tabindex/next;">
                        <option tal:repeat="lroles python:container.portal_membership.getCandidateLocalRoles(here)"
                                tal:content="lroles"
                                i18n:translate="">
                           Role name
                        </option>
                    </select>
                </div>
        
        		</div>
    
        		<div class="row">
        		
        			  <div class="label">&nbsp;</div>
        			
        			  <div class="field">
                    <input class="context" 
                           type="submit" 
                           value="Assign Local Role to Selected User(s)"
                           i18n:attributes="value"
                           tabindex=""
                           tal:attributes="tabindex tabindex/next;"
                           />
                </div>
        		
        		</div>			
		
		    </form>				


    </metal:block>

	
    <div>
        <span tal:condition="python:test(not search_submitted or (search_submitted and not search_results), 1, 0)">
       		  <h1>
                <span i18n:translate="heading_assign_localrole">Assign local roles to folder
      			    <span tal:content="here/title_or_id" i18n:name="folder">title</span>
		</span>
      			</h1>
      			
      			<p i18n:translate="description_assign_localrole">
      			A local role is a way of allowing other users into some or all of your
      			folders. These users can edit items, publish them - et cetera, depending
      			on what permissions you give them.
      			
                <br />
                
                Local roles are ideal in cooperation projects, and as every item has a
      			history and an undo option, it's easy to keep track of the changes.
      			
                <br />
                
                To give a person a local role in this folder, just search for the person's
      			name or email address in the form below, and you will be presented with a
      			page that will show you the options available.
      			</p>
    			
      			<form class="group"
                  method="post" 
                  name="localrole" 
                  action="folder_localrole_form">
      			
                <span class="legend" i18n:translate="legend_search_terms">Search Terms</span>
      			    
                <input type="hidden" name="role_submit" value="role_submit" />
      			
          			<div class="row">
          			
          			<div class="label" i18n:translate="label_search_by">
          				Search by
          			</div>
          				
                <div class="field">
                    <select name="search_param"
                            tabindex=""
                            tal:attributes="tabindex tabindex/next;">
                        <option value="username" i18n:translate="label_user_name">User Name</option>
                        <option value="email" i18n:translate="label_email_address">Email Address</option>
          					</select>
                </div>
          			
                </div>
          			
                <div class="row">
          			
                    <div class="label"
                         i18n:translate="label_search_term">
                        Search Term
                    </div>

                    <div class="field">
                        <input type="text" 
                               name="search_term" 
                               size="30"
                               tabindex=""
                               tal:attributes="tabindex tabindex/next;"
                               />
                    </div>

                </div>
          
                <div class="row">
          			
                    <div class="label">&nbsp;</div>
          				
                    <div class="field">
                        <input class="context" 
                               type="submit" 
                               value="Perform Search"
                               i18n:attributes="value"
                               tabindex=""
                               tal:attributes="tabindex tabindex/next;" 
                               />
                    </div>

          			</div>
                  			
            </form>

        </span>
    
        <hr />
    
        <h1>
            <span i18n:translate="heading_currently_assigned_localroles">Currently assigned local roles in folder
        		<span tal:content="here/title_or_id" i18n:name="folder">title</span>
	    </span>
        </h1>

        <p i18n:translate="description_current_localroles">
            These users currently have local roles assigned in this folder:
        </p>

        <form class="group"
              method="post" 
              name="deleterole" 
              action="folder_localrole_edit">
    
            <span class="legend" i18n:translate="legend_assigned_roles">Assigned Roles
                <span tal:content="here/title_or_id" i18n:name="folder">title</span>
            </span>

            <input type="hidden" name="change_type" value="delete">
            <input type="hidden" name="member_role" value="">

    	
            <div class="row">


                <span class="card" 
                      tal:repeat="lrole here/get_local_roles"
                      tal:define="username python:container.portal_membership.getAuthenticatedMember().getUserName();">
            
                    <span>
                        <img src="defaultUser.gif" alt="Blank picture" />
                			  <br />
                
                        <input class="noborder" 
                               type="checkbox"
                               name="member_ids:list" 
                               value="sequence-key"
                               tabindex=""
                               tal:condition="python:lrole[0]!=username"
                               tal:attributes="value python:lrole[0];
                                               tabindex tabindex/next" 
                               />
                
                		</span>
                			
                		<br />
                		
                		<strong class="field" tal:content="python:lrole[0]">
                		sequence-key; 
                		</strong>
                
                		<br />
                			
                		<span i18n:translate="label_roles">
                        Role(s): 
                        </span>
                        
                        <br />	
                		
                		<span class="field"
                          tal:replace="python:join(lrole[1], ', ')">
                		_.string.join( _['sequence-item'], ', ')
                		</span>
            
                </span>

            </div>

            <div class="row">
            		
                <div class="label">&nbsp;</div>
            		
            		<div class="field">
                    <input class="context" 
                           type="submit" 
                           value="Delete Selected Role(s)"
                           i18n:attributes="value"
                           tabindex=""
                           tal:attributes="tabindex tabindex/next;" 
                           />
            		</div>
            		
            </div>

        </form>

    </div>	


</div>
	   
</body>
</html>
