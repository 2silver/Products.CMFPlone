<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<tal:block metal:fill-slot="head_slot">
   <tal:block tal:define="dummy python:request.set('disable_border',1)" />
</tal:block>

<body>

<div metal:fill-slot="main"
     tal:define="errors python:request.get('errors', {});
                Batch python:modules['ZTUtils'].Batch;
                b_start python:request.get('b_start',0);
                portal_roles mtool/getPortalRoles;"
     tal:condition="here/rejectAnonymous" >

<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->
<div id="contentTabs">
    <a class=""
       href=""
       tal:attributes="href string: prefs_users_overview"
    >Users</a>
    <a class="selected"
       href=""
       tal:attributes="href string:${template/id}"
    >Groups</a>
</div>
<div id="contentBar">&nbsp;</div>
<!-- End of tabs -->

<div class="document editable">

    <h1 i18n:translate="">Groups Management</h1>

    <p i18n:translate="">
    Groups are logical collections of users, like departments and business units.
    They are not directly related to permissions on a global level, you normally
    use Roles for that - and let certain Groups have a particular role.
    </p>

    <form action=""
          name="groups"
          method="post"
          tal:attributes="action here/absolute_url"
          tal:define="groups python:Batch(here.portal_groups.listGroups(), 25, int(b_start), orphan=1)">

	<input
		tabindex=""
		type="text"
		name="addname"
		value=""
		tal:attributes="tabindex tabindex/next;"
		/>

       <input class="standalone add"
              tabindex=""
              type="submit"
              name="prefs_group_add:method"
              value="Add New Group"
              tal:attributes="tabindex tabindex/next;"
              />

	<!-- jcc says: this is confusing. I think quicksearch should right-aligned. There are other solutions, but these two should not
	be adjacent visually. -->

<!-- jcc: hiding until it actually works
       <input class="quickSearch"
              tabindex=""
              type="text"
              name=""
              value="Quick Search"
              tal:attributes="tabindex tabindex/next;"
              />
-->

        <table class="listing"
               tal:condition="groups">

            <tr>
                <th rowspan="2">Group name</th>
                <th colspan="3"
                    tal:attributes="colspan python:len(portal_roles)">Roles</th>
                <th rowspan="2">Remove Group</th>
            </tr>
            <tr>
                <tal:header repeat="portal_role portal_roles">
                <th tal:content="portal_role">Role</th>
                </tal:header>
            </tr>

            <tal:block repeat="this_group groups">

            <tr
                tal:define="oddrow repeat/this_group/odd"
                 tal:attributes="class python:test(oddrow,'odd','even')">

            <tal:block define="roles python:['this']">

            <td>
                <a href="prefs_group_details"
                   tal:attributes="href string:${here/absolute_url}/prefs_group_details?groupname=${this_group/getGroupName}">

                    <img src="" tal:replace="structure portal/group.gif" />&nbsp;
		    <span  tal:replace="this_group/getGroupName">group name</span>
                </a>
            </td>

            <td class="checkbox"
                tal:define="group_roles python:this_group.getRoles();"
                tal:repeat="portal_role portal_roles">
            
                <input type="checkbox" 
                       class="noborder"
                       name="name"
                       value="Manager"
                       tal:attributes="name string:group_${this_group/getGroupName}:list;
                                       value portal_role;
                                       checked python:test(portal_role in group_roles, 'checked' ,'');" />
            </td>

            <td class="checkbox">
                <input type="checkbox"
                       class="noborder notify"
                       name="delete:list"
                       value="value"
                       tal:attributes="value this_group/getGroupName" />
            </td>
            
            </tal:block>
        </tr>
        </tal:block>
        </table>

        <input class="context"
               tabindex="" 
               type="submit" 
               name="prefs_group_manage:method" 
               value="Save Changes"
               tal:attributes="tabindex tabindex/next;"
               />

    </form>

    <h1 i18n:translate="">Roles Management</h1>

    <p i18n:translate="">
    Roles are collections of permissions. The most common role is the Member
    role, which is any member of the portal. You can define additional roles,
    but you normally only do that when you need to create a new discrete unit
    of permissions that you can combine to make up a Group.
    </p>
    
</div>
    
</div>

</body>
</html>

