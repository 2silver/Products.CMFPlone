<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<tal:block metal:fill-slot="head_slot">
   <tal:block tal:define="dummy python:request.set('disable_border',1)" />
</tal:block>

<body>

<div metal:fill-slot="main"
     tal:define="errors python:request.get('errors', {});
                Batch python:modules['ZTUtils'].Batch;
                b_start python:request.get('b_start',0);
                acl_users here/acl_users;"
     tal:condition="here/rejectAnonymous" >
	
<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->
<div id="contentTabs"> 
    <a class="selected" 
       href=""
       tal:attributes="href here/absolute_url"
    >Users</a>
    <a class=""         
       href=""
       tal:attributes="href string: prefs_group_management_form"
    >Groups</a>
</div>
<div id="contentBar">&nbsp;</div>
<!-- End of tabs -->
    
<div class="document editable">    

    <h1 i18n:translate="">User Management</h1>

    <p i18n:translate="">
    Click the User Name to see and change the details of a specific user, or click 
    the envelope to send a mail. You can edit the roles and e-mail address
    and remove users directly from this form.
    You can also access the user registration form to add new users.
    To deactivate a user without deleting, just remove all the roles for that
    particular user.
    </p>

    <form action=""
          name="users"
          method="post"
          tal:attributes="action here/absolute_url"
          tal:define="portal_users python: here.portal_membership.listMembers();
                      batch python:Batch(portal_users, 25, int(b_start), orphan=1)">

       <input class="standalone add"
              tabindex=""
              type="submit"
              name="portal_form/join_form:method"
              value="Add New User"
              tal:attributes="tabindex tabindex/next;"
              />

       <input class="quickSearch"
              tabindex=""
              type="text"
              name=""
              value="Quick Search"
              tal:attributes="tabindex tabindex/next;"
              />
               

        <table class="listing"
               tal:condition="portal_users">
               
            <tr>
                <th>User name</th>
                <th>E-mail Address</th>
                <th>Reset<br />Password</th>
                <th>Remove user</th>
            </tr>
            
            <metal:block tal:repeat="this_user batch">
           
            <tal:comment replace="nothing">
            Unfortunately alot of this stuff is tied to the GroupUserFolder.  Things like getUsers()
            will return both groups and users 8-( - so you have to do alot of filtered like the below not:
            </tal:comment>
            
            <tr tal:define="oddrow repeat/this_user/odd"
                tal:condition="not: python: this_user.getId().startswith(acl_users.getGroupPrefix())"
                 tal:attributes="class python:test(oddrow,'odd','even')">
            
            <metal:block tal:define="roles python: this_user.getRoles();
                                     username python: this_user.getUserName();
                                     fullname python: this_user.getProperty('fullname')">
         
            <td>
                <input type="hidden" 
                       name="name" 
                       value=""
                       tal:attributes="name string:roles-${username}:list" />
                
                <a href="XXX_prefs_user_management_individual_form"
                    tal:attributes="href string:${here/portal_memberdata/absolute_url}/prefs_user_management_individual_form?userid=$username">
                   
                    <img src=""
                         tal:replace="structure portal/user.gif" />&nbsp;<span 
                         tal:replace="username">username</span>
                    
                    (<span tal:replace="username">Full Name</span>)

                </a>
                                
            </td>

            <td tal:define="email python: this_user.getProperty('email')">
                <a href="#"
                   tal:attributes="href string:mailto:${email}">
                <img src=""
                     tal:replace="structure portal/mail_icon.gif" />   
                </a>
                <input type="text" 
                       size="20" 
                       name="" 
                       value=""
                       tal:attributes="name string:email_entered_$username;
                                       value email" />
                <input type="hidden"
                       name="email_original_username"
                       tal:attributes="name string:email_original_$username;
                                       value email" />

            </td>

            <td class="checkbox">
                <input type="checkbox"
                       class="noborder"
                       name="resetpassword:list"
                       value="value"
                       tal:attributes="value username" />
            </td>
            
            <td class="checkbox">
                <input type="checkbox"
                       class="noborder notify"
                       name="delete:list"
                       value="value"
                       tal:attributes="value username" />
            </td>
            
            </metal:block>
        </tr>
        </metal:block>
        </table>

        <input class="context"
               tabindex="" 
               type="submit" 
               name="prefs_user_manage:method" 
               value="Apply Changes"
               tal:attributes="tabindex tabindex/next;"
               />

    </form>

</div>
    
</div>

</body>
</html>

