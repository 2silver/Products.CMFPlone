<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <metal:block fill-slot="top_slot"
               tal:define="dummy python:request.set('disable_border',1)" />

  <body>

    <div metal:fill-slot="main">
      <metal:block tal:condition="not: request/paths | nothing">
        <tal:block tal:replace="nothing"
                   tal:condition="not: request/paths | nothing"
                   tal:define="referer request/HTTP_REFERER;
                               existing_message python:referer.find('portal_status_message');
                               target_url python:test(existing_message!=-1, referer[:referer.find('?')], referer);
                               dummy python:request.RESPONSE.redirect('%s?%s' % ( target_url
                               , 'portal_status_message=Please+select+one+or+more+items+to+rename.'))">
          If someone goes to this form with selecting a object to rename
          We wil redirect them back from where the came from saying they
          need to select an item to rename.  This is very messy and should
          be a PythonScript.
        </tal:block>
      </metal:block>

      <h1 i18n:translate="heading_rename_item">Rename item</h1>

      <p i18n:translate="description_rename_item">Each item has a Name and a Title, which you can change by entering the new details below.</p>
      <form name="folder_rename"
            action="folder_rename"
            method="post"
            tal:define="paths request/paths|nothing;
                        items python:here.getObjectsFromPathList(paths);
                        errors options/state/getErrors;"
            tal:attributes="action template/getId"
            tal:condition="items">

        <input type="hidden" name="form.submitted" value="1" />
        <input type="hidden" name="orig_template"
               tal:condition="request/orig_template|nothing"
               tal:attributes="value request/orig_template"/>

        <fieldset tal:repeat="obj items">

          <tal:block define="item obj/getId;
                             item_path python:'/'.join(obj.getPhysicalPath());
                             error python:errors and errors.get(item, None);">

            <legend>
              <span tal:replace="item" />
              <span tal:condition="obj/Title|nothing"
                    tal:replace="string:(${obj/Title})" />
            </legend>

            <div class="field"
                 tal:attributes="class python:test(error, 'field error', 'field')">

              <div tal:condition="error"
                   tal:content="error">Validation error output</div>

              <div tal:define="canRenameItem python:mtool.checkPermission('Delete objects', obj) and mtool.checkPermission('Copy objects', obj);"
                   tal:attributes="class python:test(canRenameItem, nothing, 'error')">

                <label i18n:translate="label_new_short_name">
                  New Short Name
                </label><div></div>

                    <span tal:condition="not:canRenameItem"
                          i18:translate="rename_item_not_allowed">
                        You are not allowed to modify the id of this item.
                    </span>

                    <input type="hidden"
                           name="paths:list"
                           value="fav_999816073"
                           tal:condition="canRenameItem"
                           tal:attributes="value item_path" />

                    <input type="text"
                           name="new_ids:list"
                           value=""
                           size="60"
                           tabindex=""
                           tal:condition="canRenameItem"
                           tal:attributes="value item;
                                           tabindex tabindex/next;" />

              </div>

              <div tal:define="canModifyItem python:mtool.checkPermission('Modify portal content', obj);"
                   tal:attributes="class python:test(canModifyItem, nothing, 'error')">

                <label i18n:translate="label_new_title">
                  New Title
                </label><div></div>

                    <span tal:condition="not:canModifyItem"
                          i18:translate="change_id_for_item_not_allowed">
                        You are not allowed to modify the title of this item.
                    </span>

                    <input type="text"
                           name="new_titles:list"
                           value="title"
                           size="60"
                           tabindex=""
                           tal:condition="canModifyItem"
                           tal:attributes="value obj/Title;
                                           tabindex tabindex/next;" />

              </div>

            </div>

          </tal:block>

        </fieldset>

        <div class="formControls">

          <input class="context"
                 type="submit"
                 value="Rename All"
                 name="form.button.RenameAll"
                 tabindex=""
                 i18n:attributes="value"
                 tal:attributes="tabindex tabindex/next;"
                 />
          <input class="standalone"
                 type="submit"
                 value="Cancel"
                 name="form.button.Cancel"
                 tabindex=""
                 i18n:attributes="value"
                 tal:attributes="tabindex tabindex/next;"
                 />
        </div>

      </form>


    </div>

  </body>
</html>
