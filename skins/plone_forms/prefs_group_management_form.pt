<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<tal:block metal:fill-slot="head_slot">
   <tal:block tal:define="dummy python:request.set('disable_border',1)" />
</tal:block>

<body>

<div metal:fill-slot="main"
     tal:define="errors python:request.get('errors', {});
                Batch python:modules['ZTUtils'].Batch;
                b_start python:request.get('b_start',0);
                acl_users here/acl_users;
                portal_roles mtool/getPortalRoles;"
     tal:condition="here/rejectAnonymous" >
	
    <h1 i18n:translate="">Groups Management</h1>

    <p i18n:translate="">
    Groups are logical collections of users, like departments and business units.
    They are not directly related to permissions on a global level, you normally
    use Roles for that - and let certain Groups have a particular role.
    </p>

    <form action=""
          name="groups"
          method="post"
          tal:condition="python:hasattr(acl_users,'getGroupNames')"
          tal:attributes="action here/absolute_url"
          tal:define="groups python:Batch(acl_users.getGroupNames(), 25, int(b_start), orphan=1)">

       <input class="standalone add"
              tabindex=""
              type="submit"
              name=""
              value="Add New Group"
              tal:attributes="tabindex tabindex/next;"
              />

       <input class="quickSearch"
              tabindex=""
              type="text"
              name=""
              value="Quick Search"
              tal:attributes="tabindex tabindex/next;"
              />
               

        <table class="listing"
               tal:condition="groups">
               
            <tr>
                <th rowspan="2">Group name</th>
                <th colspan="3" 
                    tal:attributes="colspan python:len(portal_roles)">Roles</th>
                <th rowspan="2">Remove Group</th>
            </tr>
            <tr>
                <tal:header repeat="portal_role portal_roles">
                <th tal:content="portal_role">Role</th>
                </tal:header>
            </tr>
            
            <metal:block 
                         tal:repeat="this_group python:[acl_users.getGroup(group) for group in groups]">

            <tr 
                tal:define="oddrow repeat/this_group/odd"
                 tal:attributes="class python:test(oddrow,'odd','even')">
            
            <metal:block tal:define="roles python:['this'];
                                     groupname python:this_group">
         
            <td>
                <a href="prefs_group_management_individual_form"
                   tal:define="removeprefix python:groupname.getId()[len(acl_users.getGroupPrefix()):]"
                   tal:attributes="href string:${here/absolute_url}/prefs_group_management_individual_form?groupname=$removeprefix">
                   
                    <img src=""
                         tal:replace="structure portal/group.gif" />&nbsp;<span 
                         tal:replace="python:groupname.getUserName()[len('group_'):]">group name</span>
                </a>
            </td>
            
            
            <!-- XXX - Somebody has to make this iterate over the available
                       roles and show the correct roles for a group - and make it capable of
                       writing them back -->

            <td class="checkbox" 
                tal:define="group_roles python:this_group.getRoles();"
                tal:repeat="portal_role portal_roles">
            
                <input type="checkbox" 
                       class="noborder"
                       name="name"
                       value="Manager"
                       tal:attributes="name string:$this_group:list;
                                       value portal_role;
                                       checked python:test(portal_role in group_roles, 'checked' ,'');" />
            </td>
            
            <td class="checkbox">
                <input type="checkbox"
                       class="noborder notify"
                       name="delete:list"
                       value="value"
                       tal:attributes="value python:groupname" />
            </td>
            
            </metal:block>
        </tr>
        </metal:block>
        </table>

        <input class="context"
               tabindex="" 
               type="submit" 
               name="prefs_group_manage:method" 
               value="Save Changes"
               tal:attributes="tabindex tabindex/next;"
               />

    </form>

    <h1 i18n:translate="">Roles Management</h1>

    <p i18n:translate="">
    Roles are collections of permissions. The most common role is the Member
    role, which is any member of the portal. You can define additional roles,
    but you normally only do that when you need to create a new discrete unit
    of permissions that you can combine to make up a Group.
    </p>
    
    
</div>

</body>
</html>

