<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<tal:head metal:fill-slot="head_slot"
          tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="main"
     tal:define="errors python:request.get('errors', {});
                 acl_users here/acl_users;
                 portal_roles mtool/getPortalRoles;
                 gtool here/portal_groups;
                 gdtool here/portal_groupdata;
                 groupname request/groupname|nothing;
                 grouproles python:request.set('grouproles', []);
                 group python:gtool.getGroupById(groupname)">

    <tal:conditional condition="group">
        <tal:defines define="dummy python:request.set('grouproles', group.getRoles())" />
    </tal:conditional>

<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->
<div id="contentTabs"> 
    <a class="selected" 
       href=""
       tal:attributes="href string:${template/id}?groupname=${groupname}"
    >Group</a>
    <a class=""         
       href=""
       tal:attributes="href string:prefs_group_members?groupname=${groupname}"
    >Group Members</a>
</div>
<div id="contentBar">&nbsp;</div>
<!-- End of tabs -->
    
<div class="document editable"
   tal:condition="not:group | nothing">
    <h1 i18n:translate="">Group Members</h1>

    <p>No group was specified.</p>

    <p><a href="prefs_groups_overview">Find a group here</a></p>
</div>

<div class="document editable"
   tal:condition="group | nothing">

    <h1 i18n:translate="">Edit Group Properties for <span tal:replace="group/getGroupName | default">#unavailable#</span></h1>

    <p i18n:translate="">
    Groups are logical collections of users, like departments and business units.
    They are not directly related to permissions on a global level, you normally
    use Roles for that - and let certain Groups have a particular role.
    </p>

    <form class="group"
          action=""
          name="groups"
          method="post"
          tal:condition="group | nothing"
          tal:attributes="action string:${here/portal_groups/absolute_url}"
          tal:define="targetobject gdtool;
                      targetGetProperty nocall:group/getProperty | nothing;">

        <span class="legend">Group Properties</span>

        <input type="hidden" name="groupname" value="groupname"
               tal:attributes="value group/getGroupName | nothing"/>

         <tal:set tal:condition="targetobject/management_page_charset|nothing"
                  tal:define="dummy python:request.set('management_page_charset_tag','')" />

         <tal:set tal:condition="not:targetobject/management_page_charset|nothing">
            <tal:defines define="dummy python:request.set('management_page_charset','UTF-8');
                                 dummy python:request.set('management_page_charset_tag','UTF-8:');" />
         </tal:set>

        <tal:properties repeat="property targetobject/propertyMap">

          <div class="row">

          <label for="value"
                 tal:define="global id property/id;
                             global type property/type;
                             global propertyvalue python:targetGetProperty(id, None);"
                 tal:attributes="for id"
                 tal:content="python:targetobject.propertyLabel(id)">Property Value</label>


              <div class="field"
                   tal:define="propertyitem python:targetobject.getProperty(id)"
               tal:condition="python:'w' in property.get('mode', 'awd')">

               <input type="text" name="id" size="35"
                      tal:condition="python:type in ('int', 'long')"
                      tal:attributes="name string:$id:$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />

               <input type="text" name="id" size="35"
                      tal:condition="python:type in ('float','date')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />
 
               <input type="text" name="string and ustring" size="35"
                      tal:condition="python:type in ('string','ustring')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />
               
               <input type="checkbox" 
                      class="noborder"
                      name="id" 
                      id="cb-checkbox"
                      tal:condition="python: type in ('boolean',)"
                      tal:attributes="name string:$id:$type;
                                      id string:cb-$id;
                                      checked python:test(propertyvalue, 'checked', '')" />

               <input name="tokens and utokens" value="" type="text" size="35"
                      tal:condition="python:type in ('tokens', 'utokens')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;
                                      value python:test(propertyvalue, propertyvalue, '')" />

               <textarea name="text and utext" 
                      rows="6" 
                      cols="35"
                      tal:condition="python: type in ('text', 'utext')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type"
                      tal:content="propertyvalue">some data</textarea>

               <textarea name="lines and ulines" 
                      rows="6" 
                      cols="35"
                      tal:condition="python: type in ('lines', 'ulines')"
                      tal:attributes="name string:$id:${request/management_page_charset_tag}$type;"
                      tal:content="propertyvalue"><tal:content 
                tal:repeat="line propertyvalue"><span tal:replace="string:line\n"/></tal:content>
                </textarea>   


                <tal:selections tal:condition="python:type in ('selection', 'multiple selection')"
                                tal:define="select_variable python:property.get('select_variable','')">

                <tal:define condition="select_variable"
                            define="global select_value python:path('here/%s' %select_variable);" />

                <select name="selection" tal:condition="python:type in ('selection',)"
                    tal:attributes="name string:$id:${request/management_page_charset_tag}text">
                    <tal:values repeat="option select_value">
                        <option tal:attributes="SELECTED python:test(propertyvalue==option,'SELECTED','')"
                            tal:content="option">value</option>
                    </tal:values>
                </select>

                <select name="multiple selection" multiple tal:condition="python:type in ('multiple selection',)"
                        tal:attributes="name string:$id:${request/management_page_charset_tag}list:string;
                                        size python:min(7, len(select_value));">
                    <tal:values repeat="option select_value">
                        <option tal:attributes="SELECTED python:test(propertyvalue and option in propertyvalue,
                                                                    'selected', '')"
                                tal:content="option">value</option>
                    </tal:values>
                </select>
    
                </tal:selections>
    
              </div>
              
            </div>

        </tal:properties>

        <input class="context"
               type="submit" 
               name="prefs_group_edit:method" 
               value="Save" />
    </form>
<!--
    <form class="group"
          action=""
          name="groups"
          method="post"
          tal:attributes="action here/absolute_url">

        <span class="legend">Group Properties</span>     
          
        <div class="row">
            <div class="label">Group Name</div>
    
            <div class="field">   
                <input type="text" name="groupname" value="" 
                       tal:attributes="value groupname" 
                       tal:condition="not: groupname"
                       /> 

                <span tal:replace="groupname"
                      tal:condition="groupname">
                Group name (if already assigned)
                </span>
            </div>
        </div>
            
        <div class="row">
            <div class="label">Roles</div>
    
            <div class="field">   
                <select name="roles:list" multiple>
                  <tal:options repeat="role portal_roles">
                        <option tal:content="role"
                                tal:attributes="selected python:test(role in request['grouproles'], 'selected', '')">
                        Portal Role
                        </option>
                  </tal:options>
                </select>
            </div>
        </div>

    <input class="context"
           type="submit" 
           name="prefs_group_edit:method" 
           value="Save" />

    </form>
-->
</div>
    
</div>

</body>
</html>

