<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">
<body>

<div metal:fill-slot="main"
      tal:condition="here/rejectAnonymous">

    <metal:block tal:condition="not: request/ids|nothing">
      <metal:block tal:define="dummy python:request.RESPONSE.redirect(here.absolute_url()+'/folder_contents?portal_status_message=You+must+select+some+content+to+change+status+for.')">
        Usability nit-pick: if the user has not selected 
	any ids to publish we will redirect back to the 
	folder_contents with a message
      </metal:block>
    </metal:block>
      
    <script language="JavaScript" 
            src="cmf_skin_tools/calendar.js"
            tal:attributes="src string:${here/portal_url}/cmf_skin_tools/calendar.js">
    </script>

    <h1 i18n:translate="">Publish contents</h1>
    
    <p i18n:translate="">
    An item's status (also called its review state) determines who can see it.
    A <strong>private</strong> item can only be viewed by its Owner and by the site
    management. Only <strong>published</strong> items are available to the general
    member base and anonymous visitors. To make an item published, it
    has to be reviewed by one of the site's Reviewers. You can request
    that an item be reviewed by <strong>sumbitting it for review</strong>. <br />
        
    Another way to control the visibility of an item is with its <strong>effective
    date</strong>. An item is not publicly available before its effective date,
    <em>even if its status is <strong>published</strong></em>.
    </p>
    
    <form class="group"
          id="edit_form"
          name="edit_form" 
          method="post" 
          action="folder_publish"
	  tal:define="physical_path python:'/'.join(here.getPhysicalPath())">
       
        <span class="legend" i18n:translate="">Publishing Details</span>
        <div class="row">
            <div class="label" i18n:id="affected_content">Affected content</div>
            <div class="field"
                 tal:define="Batch python:modules['ZTUtils'].Batch;
                             dummy python:request.set('ids_checked', 1);
                             global batch python:Batch([b.getObject() for b in here.portal_catalog(path={'query':physical_path, 'level':0}, id=request.get('ids', ' ', path))], 50, int(0), orphan=0);
			                 global folders_in_publishing python:[o.getId() for o in batch if o.isPrincipiaFolderish];"
                 tal:condition="batch">
                <table metal:use-macro="here/folder_contents/macros/folder_listing">
                </table>
            </div>
        </div>

        <div class="row"
	         tal:condition="folders_in_publishing">
            <div class="label">
            <span i18n:id="subfolders">Subfolders</span>
                <div id="include_subfolders_help" 
                     i18n:id="include_subfolders_help"
                     class="help" 
                     style="visibility:hidden">
                 If checked, will attempt to publish all content in subfolders.
                 </div>	
            </div>
            <div class="field">
               <input type="checkbox"
                      class="noborder"
                      id="include_subfolders"
                      name="include_subfolders"
                      tabindex="2" 
                      onfocus="formtooltip('include_subfolders_help',1)" 
                      onblur="formtooltip('include_subfolders_help',0)" 
                      checked="checked" />
                <label for="include_subfolders" i18n:id="include_subfolders">Include subfolders</label>

           </div>
	</div>
	
        <div class="row">
            <div class="label">
              <span i18n:id="effective_date">Effective Date</span>
                <div id="format_help"
                     i18n:id="effective_date_help" 
                     class="help" 
                     style="visibility:hidden">
                The date when the document will be visible when it's published. This way, you can 
                publish a document in advance, but it will not be visible before this date.  If no date is select 
                the document will be effective immediately.
                </div>
            </div>
            <div class="field">
                <div tal:define="inputname  string:effective_date; 
                                 formname   string:edit_form;
                                 inputvalue string:">
                  <div metal:use-macro="here/calendar_support/macros/calendarDatePickerBox">
                    a calendar, hopefully
                  </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="label">
              <span i18n:id="expiration_date">Expiration Date</span>
                <div id="expiration_date_help"
                     i18n:id="expiration_date_help" 
                     class="help" 
                     style="visibility:hidden">
                The date when the document expires. This will automatically make the document
                invisible for others at the given date. If no date is chosen, it will never expire.
                </div>
            </div>
            <div class="field">
                <div tal:define="inputname  string:expiration_date; 
                                 formname   string:edit_form;
                                 inputvalue string:">
                  <div metal:use-macro="here/calendar_support/macros/calendarDatePickerBox">
                    a calendar, hopefully
                  </div>
                </div>
            
            </div>
        </div>

        <div class="row">
            <div class="label">
            <span i18n:id="comments">Comments</span>
                <div id="publishing_comments_help"
                     i18n:id="publishing_comments_help" 
                     class="help" 
                     style="visibility:hidden">
                Enter a short description or some comments to be added
                to the comments field in the publishing history. If multiple
                items are selected, this comment will be attached to all of
                them.
                </div>
            </div>
            <div class="field">
                <textarea id="comment" 
                          name="comment" 
                          cols="60" 
                          rows="5"
                          onfocus="formtooltip('publishing_comments_help',1)" 
                          onblur="formtooltip('publishing_comments_help',0)" 
                          ></textarea>
            </div>
        </div>

        <div class="row">
            <input type="hidden" id="workflow_action" name="workflow_action" value="" />
            <div class="label">&nbsp;</div>
    
            <div class="field"
                 tal:define="wf_actions actions/workflow;
                 publish python:here.getActionUrlById('publish', wf_actions);
                 submit python:here.getActionUrlById('submit', wf_actions);
                 retract python:here.getActionUrlById('retract', wf_actions);
                 hide python:here.getActionUrlById('hide', wf_actions);
                 reject python:here.getActionUrlById('reject', wf_actions);
                 visible python:here.getActionUrlById('visible', wf_actions);
                 show python:here.getActionUrlById('show', wf_actions);">
		  
                <input class="context" type="submit" value="Show" 
                       onclick="javascript:document.getElementById('workflow_action').value='show';" />

                <input class="context" type="submit" value="Visible" 
                       onclick="javascript:document.getElementById('workflow_action').value='visible';" />
		       
                <input class="context" type="submit" value=" Publish this Item " 
                       onclick="javascript:document.getElementById('workflow_action').value='publish';" />
             
                <input class="context" type="submit" value="Submit for review" 
                       onclick="javascript:document.getElementById('workflow_action').value='submit';" />

                <input class="context" type="submit" value="Retract" 
                       onclick="javascript:document.getElementById('workflow_action').value='retract';" >

                <input class="context" type="submit" value="Hide" 
                       onclick="javascript:document.getElementById('workflow_action').value='hide';" />

                <input class="context" type="submit" value="Reject" 
                       onclick="javascript:document.getElementById('workflow_action').value='reject';" />
    
            </div>
            
        </div>

    </form>


</div>
  
</body>
</html>

