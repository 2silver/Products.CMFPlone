## Script (Python) "document_edit"
##parameters=text_format, text, file='', SafetyBelt='', choice=' Change ', title='', description='', id=''
##title=Edit a document

errors = context.portal_form_validation.validate(context, 'validate_document_edit')
if errors:
    edit_form=context.portal_navigation.getNextPageFor( context
                                                , script.getId()
                                                , 'failure')
    return edit_form()

filename=getattr(file, 'filename', '')
if file and filename and context.isIDAutoGenerated(id):
    id=filename[max( filename.rfind('/')
                   , filename.rfind('\\')
                   , filename.rfind(':') )+1:]

if file and filename:
    file.seek(0)

context.edit( text_format
            , text
            , file
            , safety_belt=SafetyBelt
            )

context.plone_utils.contentEdit(context,
                                id=id,
                                description=description)

return context.portal_navigation.getNextRequestFor( context
                                            , script.getId()
                                            , 'success'
                                            , portal_status_message='Document changed.')
