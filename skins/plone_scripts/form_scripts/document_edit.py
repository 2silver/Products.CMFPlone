## Script (Python) "document_edit"
##parameters=text_format, text, file='', SafetyBelt='', choice=' Change ', title='', description='', id=''
##title=Edit a document

errors = context.portal_form_validation.validate(context, 'validate_document_edit')
if errors:
    # get and return the relevant edit form
    edit_form = getattr(context, context.getTypeInfo().getActionById('edit'))
    return edit_form()


filename=getattr(file, 'filename', '')
if file and filename and context.isIDAutoGenerated(id):
    id=filename[max( string.rfind(filename, '/')
                   , string.rfind(filename, '\\')
                   , string.rfind(filename, ':') )+1:]

if file and filename:
    file.seek(0)

context.edit( text_format
            , text
            , file=file
            , safety_belt=SafetyBelt
            )

context.plone_utils.contentEdit(context,
                                id=id,
                                description=description)

qst='portal_status_message=Document+changed.'

context.REQUEST.RESPONSE.redirect( '%s/%s?%s' % ( context.absolute_url()
                                                , context.getTypeInfo().getActionById( 'view' )
                                                , qst
                                                ) )