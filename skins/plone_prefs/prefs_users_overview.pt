<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master">

<tal:block metal:fill-slot="head_slot">
   <tal:block tal:define="dummy python:request.set('disable_border',1)" />
</tal:block>

<body>

<div metal:fill-slot="main"
     tal:define="errors python:request.get('errors', {});
                Batch python:modules['ZTUtils'].Batch;
                b_start python:request.get('b_start',0);
                acl_users here/acl_users;"
     tal:condition="here/rejectAnonymous" >

<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->
<ul id="contentTabs">
  <li class="">
    <a href="plone_control_panel"
       i18n:translate="">Plone Setup</a>
  </li>
  <li class="selected">
    <a href=""
       tal:attributes="href string:${template/id}"
       i18n:translate="">Users</a>
  </li>
  <li class="">
    <a href=""
       tal:attributes="href string: prefs_groups_overview"
       i18n:translate="">Groups</a>
  </li>
</ul>
<div id="contentBar">&nbsp;</div>
<!-- End of tabs -->

<div class="document editable">

    <h1 i18n:translate="heading_user_management">User Management</h1>

    <form action=""
          name="users"
          method="post"
          tal:attributes="action here/absolute_url"
          tal:define="portal_users python: here.portal_membership.listMembers();
                      batch python:Batch(portal_users, 25, int(b_start), orphan=1)">

    <!-- jcc says: this is my solution to a confusing situation. There are other solutions, but this and the add form should not
           be adjacent visually. Do we even need a quicksearch? -->
    <span tal:omit-tag="" i18n:translate="label_quick_search">Quick search</span>:
    <input class="quickSearch"
           tabindex=""
           type="text"
           name="searchstring"
           value=""
           tal:attributes="tabindex tabindex/next;"
           />

    <input type="hidden" name="searchonly" value="users" />
    <input type="submit"
           class="context"
           name="prefs_user_group_search_form:method"
           value="Search"
           tabindex=""
           i18n:attributes="value"
           tal:attributes="tabindex tabindex/next;" />

    <p i18n:translate="description_user_management">
      Click the User Name to see and change the details of a specific
      user, or click the envelope to send a mail. You can edit the
      and e-mail address and remove users directly from this
      form. You can also access the user registration form to add new
      users.
    </p>

       <input class="standalone add"
              tabindex=""
              type="submit"
              name="portal_form/join_form:method"
              value="Add New User"
              i18n:attributes="value"
              tal:attributes="tabindex tabindex/next;"
              />

        <table class="listing"
               tal:condition="portal_users">

            <tr>
                <th i18n:translate="listingheader_user_name">User name</th>
                <th i18n:translate="listingheader_email_address">E-mail Address</th>
                <th i18n:translate="listingheader_reset_password">Reset Password</th>
                <th i18n:translate="listingheader_remove_user">Remove user</th>
            </tr>

            <tal:comment replace="nothing">
            pjgrizel->limi: GRUF already has several API methods to return the results you'd like to have:
              - getPureUsers() behaves like getUsers() but returns no groups
              - userobject.isGroup() method returns true if userobject is a group, then you can avoid
               the hazardous "getGroupPrefix()" stuff.
              Seems like it's time to document the whole GRUF API ! :-)
            </tal:comment>

            <tal:block repeat="this_user batch">

            <tr tal:define="oddrow repeat/this_user/odd"
                 tal:attributes="class python:test(oddrow,'odd','even')">

            <tal:block define="username python: this_user.getUserName();
                               fullname python: this_user.getProperty('fullname')">

            <td>
                <!--input type="hidden"
                       name="name"
                       value=""
                       tal:attributes="name string:roles-${username}:list; value roles" / -->

                <a href="XXX_prefs_user_details"
                    tal:attributes="href string:${here/portal_memberdata/absolute_url}/prefs_user_details?userid=$username">

                    <img src=""
                         tal:replace="structure portal/user.gif" />&nbsp;<span
                         tal:replace="username">username</span>

                    (<span tal:replace="fullname">Full Name</span>)

                </a>

            </td>

            <td tal:define="email python: this_user.getProperty('email')">
                <a href="#"
                   tal:attributes="href string:mailto:${email}">
                <img src=""
                     tal:replace="structure portal/mail_icon.gif" />
                </a>
                <input type="text"
                       size="20"
                       name=""
                       value=""
                       tal:attributes="name string:email_entered_$username;
                                       value email" />
                <input type="hidden"
                       name="email_original_username"
                       tal:attributes="name string:email_original_$username;
                                       value email" />

            </td>

            <td class="checkbox">
                <input type="checkbox"
                       class="noborder"
                       name="resetpassword:list"
                       value="value"
                       tal:attributes="value username" />
            </td>

            <td class="checkbox">
                <input type="checkbox"
                       class="noborder notify"
                       name="delete:list"
                       value="value"
                       tal:attributes="value username" />
            </td>

            </tal:block>
        </tr>
        </tal:block>
        </table>

        <input class="context"
               tabindex=""
               type="submit"
               name="prefs_user_manage:method"
               value="Apply"
               i18n:attributes="value"
               tal:attributes="tabindex tabindex/next;"
               />

    </form>

</div>

</div>

</body>
</html>

