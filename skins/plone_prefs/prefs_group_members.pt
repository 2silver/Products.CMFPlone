<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/prefs_main_template/macros/master">

<tal:head metal:fill-slot="head_slot"
          tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="prefs_configlet_main"
     tal:define="errors python:request.get('errors', {});
                portal_roles mtool/getPortalRoles;
                Batch python:modules['ZTUtils'].Batch;
                b_start python:request.get('b_start',0);
                gtool here/portal_groups;
                gdtool here/portal_groupdata;
                groupname request/groupname|nothing;
                grouproles python:request.set('grouproles', []);
                group python:gtool.getGroupById(groupname);
		searchonly string:users;
		takeaction string:prefs_group_members_edit;">

    <tal:conditional condition="group">
        <tal:defines define="dummy python:request.set('grouproles', group.getRoles())" />
    </tal:conditional>

<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->
<ul id="contentTabs" style="font-size: 96%">
  <li class="">
    <a href=""
       tal:attributes="href string:prefs_group_details?groupname=${groupname}"
       i18n:translate=""
    >Group Properties</a>
  </li>
  <li class="selected">
    <a href=""
       tal:attributes="href string:${template/id}?groupname=${groupname}"
       i18n:translate=""
    >Group Members</a>
  </li>
</ul>
<div id="contentBar">&nbsp;</div>
<!-- End of tabs -->

<div id="documentContent"
     class="editableDocument"
     tal:condition="not:group | nothing">
	<h1 i18n:translate="">Group Members</h1>

    <p i18n:translate="label_no_group_specified">No group was specified.</p>

    <p><a href="prefs_groups_overview"
          i18n:translate="link_find_group">Find a group here</a></p>
</div>

<div id="documentContent"
     class="editableDocument"
     tal:condition="group | nothing">

    <h1 i18n:translate="">Members of the <tal:group content="groupname">Groupname</tal:group> Group</h1>
	
    <p i18n:translate="">
    You can add or remove users from this particular group here. Note that this
    doesn't actually delete the user, it is only removed from this group.
    </p>


	<h2>Search for new group members</h2>
	<div metal:use-macro="here/prefs_search_macros/macros/user_group_search">
	  <metal:block metal:fill-slot="hiddens">
	    <input type="hidden" name="groupname" value="groupname" tal:attributes="value group/getGroupName" />
	  </metal:block>

	  <metal:block metal:fill-slot="actions" >
	    <input class="context"
                   tabindex=""                                 
               	   type="submit"                               
               	   name="prefs_group_members_edit:method"
               	   value="Add selected users to this group"
	       	   tal:condition="batch" 
               	   tal:attributes="tabindex tabindex/next;"    
               	   i18n:attributes="value" />
	  </metal:block>

	  <metal:block metal:fill-slot="removables">
        <h2 i18n:translate="">Current Group Members</h2>
	<table class="listing">
            <tr>
                <th i18n:translate="listingheader_user_name">User name</th>
                <th i18n:translate="listingheader_email_address">E-mail Address</th>
                <th i18n:translate="listingheader_remove_user">Remove user</th>
            </tr>

            <tal:block tal:repeat="this_user group/getGroupMembers">
            <tr tal:define="oddrow repeat/this_user/odd"
                tal:attributes="class python:test(oddrow,'odd','even')">
              <tal:block tal:define="roles python: this_user.getRoles();
                                     username python: this_user.getUserName();
                                     fullname python: this_user.getProperty('fullname')">
                <td>
                    <a tal:attributes="href string:${here/portal_memberdata/absolute_url}/prefs_user_details?userid=$username">
                     <img src=""
                         tal:replace="structure portal/user.gif" />&nbsp;<span
                         tal:replace="username">username</span>

                    (<span tal:replace="fullname">Full Name</span>)

                    </a>
                </td>
		  <td tal:define="email python: this_user.getProperty('email')">
		    <a href="#" tal:attributes="href string:mailto:${email}">

                <img src=""
                     tal:replace="structure portal/mail_icon.gif" />
		      <span tal:replace="email" />
                </a>


            </td>

                <td class="checkbox">
                    <input type="checkbox"
                           class="noborder notify"
                           name="delete:list" tal:attributes="value username" />
                </td>
		</tal:block>
            </tr>
	    </tal:block>
        </table>

        <input class="destructive"
               type="submit"
               name="prefs_group_members_edit:method"
               value="Delete selected users"
               i18n:attributes="value" />
	  </metal:block>
	</div>
      </div>
    </div>
  </body>
</html>
