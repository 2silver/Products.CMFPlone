<html>
	<head>
		<title>User/Group Search Macro(s)</title>
	</head>
	<body>

<div metal:define-macro="search">
<form action=""
          name="groupsearch"
          method="post"
          tal:attributes="action string:${request/URL}"
	  tal:define="b2_start python:request.get('b_start',0);
		searchstring request/searchstring | nothing;
		searchfor searchonly | request/searching | nothing;">

	<span metal:define-slot="hiddens">
        <input type="hidden" name="userid" value="userid"
		tal:attributes="value user/getId" />
        </span>

        <span omit-tag="" i18n:translate="label_show_me">Show me</span>

        <select name="searching"
                tabindex=""
                tal:attributes="tabindex tabindex/next;"
		tal:condition="python: not here.prefs_valid_search_restriction(searchonly)">
            <option value="both" i18n:translate="">Users and groups</option>
            <option value="users" i18n:translate="">Users</option>
            <option value="groups" i18n:translate="">Groups</option>
        </select>
	<span tal:condition="python: here.prefs_valid_search_restriction(searchonly,['users'])"
              tal:omit-tag=""
              i18n:translate="">Users</span>
	<span tal:condition="python: here.prefs_valid_search_restriction(searchonly,['groups'])"
              tal:omit-tag=""
              i18n:translate="">Groups</span>

        <span omit-tag=""
              i18n:translate="label_names_containing">with names containing</span>

        <input tabindex=""
               type="text"
               name="searchstring"
               value=""
               tal:attributes="tabindex tabindex/next;" />
        <input class="context"
               tabindex=""
               type="submit"
               name="search"
               value="Search"
               tal:attributes="tabindex tabindex/next;"
               i18n:attributes="value" />
</form>

</div>

<div metal:define-macro="display">

<form action=""
          name="groupsearch"
          method="post"
          tal:attributes="action takeaction"
	  tal:define="b2_start python:request.get('b_start',0);
		searchstring request/searchstring | nothing;
		searchfor searchonly | request/searching | nothing;">

	<span metal:define-slot="hiddens">
        <input type="hidden" name="userid" value="userid"
		tal:attributes="value user/getId" />
        </span>

        <h4 i18n:translate="heading_candidates">Candidates</h4>
	<span omit-tag="" i18n:translate="description_search_string"
             >Search string</span>:
        <span tal:content="request/searchstring | default"
              i18n:translate="">none specified</span>
        <table class="listing"
               id="sortable"
	       tal:condition="exists:request/searchstring"
	       tal:define="searchresults python:Batch(here.prefs_user_group_search(searchstring, searchfor), 25, int(b2_start), orphan=1)">

            <tr>
                <th tal:condition="takeaction | nothing">&nbsp;</th>
                <th i18n:translate="listingheader_name">Name</th>
                <th i18n:translate="listingheader_type">Type</th>
            </tr>

	    <tr class="odd"
		tal:repeat="usergroup searchresults"
		tal:attributes="class python:repeat['usergroup'].even and 'even' or 'odd';">
                <td tal:condition="takeaction | nothing">
                <input class="noborder"
			type="checkbox"
			selected="selected"
			name="id:list"
			tal:attributes="value usergroup/getGroupId | usergroup/getId" />
                </td>

                <td>
                <img src="user.gif" tal:condition="not:usergroup/getGroupName | nothing" />
                <img src="group.gif" tal:condition="usergroup/getGroupName | nothing" />

                <a href="" tal:condition="not:usergroup/getGroupName | nothing"
			tal:attributes="href string:prefs_user_details?userid=${usergroup/getId}"
			tal:content="usergroup/getUserName | default"
                        i18n:translate="link_username_not_available">
			username not available
		</a>
                <a href="" tal:condition="usergroup/getGroupName | nothing"
			tal:attributes="href string:prefs_group_details?groupname=${usergroup/getGroupName}"
			tal:content="usergroup/getGroupName | default"
                        i18n:translate="link_groupname_not_available">
			groupname not available
		</a>
		</td>

                <td tal:condition="not:usergroup/getGroupName | nothing"
                    i18n:translate="">User</td>
                <td tal:condition="usergroup/getGroupName | nothing"
                    i18n:translate="">Group</td>
           </tr>

        </table>

	<tal:hide condition="takeaction | nothing">
        <input class="context"
               tabindex=""
               type="submit"
               name="addingaction"
               value="Use Selected..."
	       tal:condition="exists:request/searchstring"
               tal:attributes="tabindex tabindex/next;"
               i18n:attributes="value" />
	</tal:hide>

	<div metal:define-slot="removables" />

</form>

</div>
	</body>
</html>
