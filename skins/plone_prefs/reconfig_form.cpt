<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="prefs_configlet_main"
     tal:define="errors options/state/getErrors;">

    <h1 i18n:translate="heading_portal_setup">Site Setup</h1>

    <a href=""
       class="link-parent"
       tal:attributes="href string: $portal_url/plone_control_panel"
       i18n:translate="label_up_to_plone_setup">
    Up to Site Setup
    </a>

    <p i18n:translate="description_plone_setup">
        Site-wide settings.
    </p>

    <form action=""
          name="reconfig"
          method="post"
          class="enableUnloadProtection"
          tal:attributes="action string:${here_url}/${template_id}">

        <fieldset>
            <legend i18n:translate="legend_plone_details">Plone Details</legend>

            <div class="field"
                 tal:define="title request/title | portal_properties/title;
                             error errors/title | nothing;"
                 tal:attributes="class python:test(error, 'field error', 'field')">


                <label for="title"
                       i18n:translate="label_portal_title">Site title</label>

                <span class="fieldRequired" title="Required"
                      i18n:attributes="title title_required;"
                      i18n:translate="label_required">(Required)</span>

                <div class="formHelp" i18n:translate="help_portal_title">
                The title of your Plone site.
                </div>

                <div tal:content="error">Validation error output</div>

                <input name="title"
                       id="title"
                       size="30"
                       value=""
                       tabindex=""
                       tal:attributes="value title;
                                       tabindex tabindex/next;" />
            </div>

            <div class="field"
                 tal:define="description request/description | portal/description;
                             error errors/description | nothing;">

                <label for="description"
                       i18n:translate="label_portal_description">Portal description</label>

                <div class="formHelp" i18n:translate="help_portal_description">
                The site description is available in syndicated
                content and elsewhere. Keep it brief.
                </div>

                <textarea cols="30"
                          rows="6"
                          id="description"
                          name="description"
                          tabindex=""
                          tal:attributes="tabindex tabindex/next"
                          tal:content="description">Description</textarea>
            </div>

            <div class="field"
                 tal:define="email_from_name request/email_from_name|portal/email_from_name;
                             error errors/email_from_name | nothing;">

                <label for="email_from_name"
                       i18n:translate="label_portal_from_name">Site 'From' name</label>

                <div class="formHelp" i18n:translate="help_portal_from_name">
                Plone generates e-mail using this name
                as the e-mail sender.
                </div>

                <div tal:content="error">Validation error output</div>

                <input name="email_from_name"
                       id="email_from_name"
                       size="30"
                       value=""
                       tabindex=""
                       tal:attributes="value email_from_name;
                                       tabindex tabindex/next;" />
            </div>

            <div class="field"
                 tal:define="email_from_address request/email_from_address|portal/email_from_address;
                             error errors/email_from_address | nothing;"
                 tal:attributes="class python:test(error, 'field error', 'field')">

                <label for="email_from_address" i18n:translate="label_portal_from_address">Site 'From' address</label>

                <span class="fieldRequired" title="Required"
                      i18n:attributes="title title_required;"
                      i18n:translate="label_required">(Required)</span>

                <div class="formHelp" i18n:translate="help_portal_from_address">
                Plone generates e-mail using this address
                as the e-mail return address.
                It is also used as the destination address
                on the site-wide contact form.
                </div>

                <div tal:content="error">Validation error output</div>

                <input name="email_from_address"
                       id="email_from_address"
                       size="30"
                       value=""
                       tabindex=""
                       tal:attributes="value email_from_address;
                                       tabindex tabindex/next;" />
            </div>

            <div class="field">
                <label for="default_language"
                       i18n:translate="label_default_language">Default Language</label>

                <div class="formHelp" i18n:translate="help_default_language">
                Specify the default language setting for newly created items.
                </div>

                <!-- ISO-639-2 language selector for Plone -->
                <select name="default_language"
                        id="default_language"
                        tabindex=""
                        value=""
                        tal:attributes="value default_language;
                                        tabindex tabindex/next;">
                   <option value="" i18n:translate="label_choose_language">Choose Language</option>
                   <option tal:repeat="language here/availableLanguages"
                           tal:attributes="value python:language[0];
                                           selected python:test(default_language == language[0], 'selected', None)"
                           tal:content="structure python:language[1]" />
                </select>
            </div>

            <div class="field"
                 tal:define="validateChecked portal/validate_email;
                             allowEnterChecked not:validateChecked;
                             tabindex tabindex/next;">

                <label i18n:translate="label_password_policy">Password policy</label>

                <div class="formHelp" i18n:translate="help_password_policy">
                Determines if users can choose their initial password. If the password
                is selected by the user, it's easier for the user to create
                a bogus account. If this is a concern, choose "Generate".
                </div>

                <input class="noborder"
                       type="radio"
                       name="validate_email:int"
                       id="validate_email_on"
                       value="1"
                       tabindex=""
                       tal:attributes="checked validateChecked;
                                       tabindex tabindex;" />

                <label for="validate_email_on" i18n:translate="label_generate_and_email_passwords">Generate and e-mail user's initial password</label>

                <br />

                <input class="noborder"
                       type="radio"
                       name="validate_email:int"
                       id="validate_email_off"
                       value="0"
                       tabindex=""
                       tal:attributes="checked allowEnterChecked;
                                       tabindex tabindex;" />

                <label for="validate_email_off" i18n:translate="label_allow_members_to_create_password">Allow users to select their initial password</label>
            </div>

            <div class="field"
                 tal:condition="exists:site_properties/many_users"
                 tal:define="many_users request/many_users | site_properties/many_users;
                             tabindex tabindex/next;">

                <label i18n:translate="label_setup_many_users">Many users/groups</label>

                <div class="formHelp" i18n:translate="help_setup_many_users">
                    Determines if your Plone is optimized for a small or large
                    sites.  In environments with a lot of users and/or groups it
                    can be very slow or impossible to build a list all users or
                    groups.  This option tunes the user interface and behaviour
                    of Plone for this case by allowing you to search for
                    users/groups instead of listing all of them.
                </div>

                <input type="radio"
                       class="noborder"
                       name="many_users"
                       value="on"
                       id="cb_many_users"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked many_users"
                       />

                <label for="cb_many_users" i18n:translate="yes">Yes</label>

                <br />

                <input type="radio"
                       class="noborder"
                       name="many_users"
                       value=""
                       id="cb_nomany_users"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked not:many_users;"
                       />

                <label for="cb_nosmall_site" i18n:translate="no">No</label>
            </div>

            <div class="field"
                 tal:condition="exists:site_properties/ext_editor"
                 tal:define="ext_editor request/ext_editor | site_properties/ext_editor;
                             tabindex tabindex/next;">

                <label i18n:translate="label_setup_ext_editor">Enable External Editor Feature</label>

                <div class="formHelp" i18n:translate="help_setup_ext_editor">
                Determines if the external editor feature is enabled.
                This feature requires a special client-side application installed.
                The users also have to enable this in their preferences.
                </div>

                <input type="radio"
                       class="noborder"
                       name="ext_editor"
                       value="on"
                       id="cb_ext_editor"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked ext_editor"
                       />

                <label for="cb_ext_editor" i18n:translate="yes">Yes</label>

                <br />

                <input type="radio"
                       class="noborder"
                       name="ext_editor"
                       value=""
                       id="cb_noext_editor"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked not:ext_editor;"
                       />

                <label for="cb_noext_editor" i18n:translate="no">No</label>
            </div>

            <div class="field"
                 tal:condition="exists:site_properties/visible_ids"
                 tal:define="visible_ids request/visible_ids | site_properties/visible_ids;
                             tabindex tabindex/next;">

                <label i18n:translate="label_setup_visible_ids">
                Show "Short Name" on Content?
                </label>

                <div class="formHelp" i18n:translate="help_setup_visible_ids">
                Display and allow users to edit the "Short name" content
                identifiers, which form the URL part of a content item's
                address. Once enabled, users will then be able to enable this
                option in their preferences.
                </div>

                <input type="radio"
                       class="noborder"
                       name="visible_ids"
                       value="on"
                       id="cb_visible_ids"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked visible_ids"
                       />

                <label for="cb_visible_ids" i18n:translate="yes">Yes</label>

                <br />

                <input type="radio"
                       class="noborder"
                       name="visible_ids"
                       value=""
                       id="cb_novisible_ids"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked not:visible_ids;"
                       />

                <label for="cb_novisible_ids" i18n:translate="no">No</label>
            </div>

            <div class="field"
                 tal:condition="exists:site_properties/allowAnonymousViewAbout"
                 tal:define="allowAnonymousViewAbout request/allowAnonymousViewAbout | site_properties/allowAnonymousViewAbout;
                             tabindex tabindex/next;">

                <label i18n:translate="label_allowAnonymousViewAbout">Allow Anonymous Users To View About Information</label>

                <div class="formHelp" i18n:translate="help_allowAnonymousViewAbout">
                  Determines if an anonymous user will be allowed to view the
                  authorship information for objects and folders.
                </div>

                <input type="radio"
                       class="noborder"
                       name="allowAnonymousViewAbout"
                       value="on"
                       id="cb_allowAnonymousViewAbout"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked allowAnonymousViewAbout"
                       />

                <label for="cb_allowAnonymousViewAbout" i18n:translate="yes">Yes</label>

                <br />

                <input type="radio"
                       class="noborder"
                       name="allowAnonymousViewAbout"
                       value=""
                       id="cb_allowAnonymousViewAbout"
                       tabindex=""
                       tal:attributes="tabindex tabindex;
                                       checked not:allowAnonymousViewAbout;"
                       />

                <label for="cb_allowAnonymousViewAbout" i18n:translate="no">No</label>
            </div>

            <div class="field"
                 tal:condition="exists:site_properties/allowRolesToAddKeywords"
                 tal:define="allowRolesToAddKeywords request/allowRolesToAddKeywords|site_properties/allowRolesToAddKeywords;
		             avail_roles python:mtool.getCandidateLocalRoles(here);
                             error errors/allowRolesToAddKeywords | nothing;"
                  >
              <fieldset id="fieldset_allowRolesToAddKeywords">
                <legend i18n:translate="label_allowRolesToAddKeywords">Roles allowed to add keywords</legend>

                <div class="formHelp" i18n:translate="help_allowRolesToAddKeywords">
                  Users with one of the roles selected here are allowed to add
                  keywords to the site.
                </div>

		<ul class="configlets"
                    tal:define="allowed_roles site_properties/allowRolesToAddKeywords">
                  <li tal:repeat="role avail_roles">
                    <input class="noborder"
                           type="checkbox"
                           name="tmp_allowRoleToAddKeyword:list"
                           tal:attributes="value role;
                                           id string:tmp_allowRoleToAddKeyword_${role};
                                           checked python:test(role in allowed_roles, 'checked', '');"/>
                    <label for=""
                           i18n:translate=""
                           tal:attributes="for string:tmp_allowRoleToAddKeyword_${role}"
                           tal:content="role"
                           />
                  </li>
                </ul>
              </fieldset>
            </div>

            <div class="formControls">
                <input class="context"
                       tabindex=""
                       type="submit"
                       name="form.button.Save"
                       value="Save"
                       i18n:attributes="value label_save;"
                       tal:attributes="tabindex tabindex/next;"
                       />

            </div>

        </fieldset>

        <input type="hidden" name="form.submitted" value="1" />
        <input type="hidden" name="submitted" value="1" />

    </form>

</div>

</body>
</html>

