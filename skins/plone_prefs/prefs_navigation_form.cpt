<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="plone">

<metal:block metal:fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="prefs_configlet_main"
     tal:define="errors options/state/getErrors;
                 navtree_props portal_properties/navtree_properties;">

    <h1 i18n:translate="heading_navigation_setup">Navigation Settings</h1>

    <a href=""
       class="link-parent"
       tal:attributes="href string: $portal_url/plone_control_panel"
       i18n:translate="label_up_to_plone_setup">
    Up to Site Setup
    </a>

    <p i18n:translate="description_navigation_setup">
        Lets you control how navigation is constructed in your site.
    </p>

    <form action=""
          name=""
          method="post"
          tal:attributes="action string:${here_url}/${template_id}">

        <fieldset>
            <legend i18n:translate="legend_navigation_details">Navigation details</legend>

            <div class="field"
                 tal:define="generated_tabs python: not site_properties.disable_folder_sections;
                             generated_tabs request/generated_tabs | generated_tabs;
                             error errors/generated_tabs | nothing;"
                 tal:attributes="class python:test(error, 'field error', 'field')">

                <input type="checkbox"
                       class="noborder"
                       id="cb_allow_any"
                       name="generated_tabs"
                       value="1"
                       tal:attributes="checked python:test(generated_tabs, 'checked', None)" />

                <label i18n:translate="label_generated_tabs_enable">Automatically generate tabs</label>

                <div class="formHelp" i18n:translate="help_generated_tabs">
                By default, all items created at the root level will add to the global section
                navigation. You can turn this off if you prefer manually constructing
                this part of the navigation.
                </div>
            </div>
            
            <div class="field"
                tal:define="value python:navtree_props.getProperty('name', None);
                            value request/name|value;
                            error errors/name|nothing"
                tal:attributes="class python:error and 'field error' or 'field';">
                <label>Navigation tree portlet title</label>
                <span class="fieldRequired" title="Required"
                  i18n:attributes="title title_required;"
                  i18n:translate="label_required">(Required)
                </span>
                <div class="formHelp">
                  Change the title of the navigation tree portlet.
                </div>
                <input name="name"
                       type="text"
                       size="30"
                       tal:attributes="value value;"/>
                <div tal:content="error">Validation error output</div>
              </div>
              
              <div class="field"
                tal:define="value python:navtree_props.getProperty('root', None);
                            value request/root|value;
                            error errors/root|nothing"
                tal:attributes="class python:error and 'field error' or 'field';">
                <label>Navigation tree root</label>
                <div class="formHelp">
                    A path that specifies the base folder where the
                    navigation tree will be rooted. Use <strong>'/'</strong> for the
                    portal root, and <strong>'/folder1'</strong> to start at 'folder1'.
                    Use <strong>'.'</strong> to start at the current folder.
                </div>
                <input name="root"
                       type="text"
                       size="30"
                       tal:attributes="value value;"/>
                <div tal:content="error">Validation error output</div>
              </div>
              
              <div class="field"
                tal:define="
                  value python:navtree_props.getProperty('topLevel');
                  value request/topLevel|value;
                  error errors/topLevel|nothing"
                tal:attributes="class python:error and 'field error' or 'field';">
                <label>Navigation tree start level</label>
                <span class="fieldRequired" title="Required"
                  i18n:attributes="title title_required;"
                  i18n:translate="label_required">(Required)
                </span>
                <div class="formHelp">
                  An integer value that specifies the number of folder levels 
                  below the site root that must be exceeded before the
                  navigation tree will display. 0 means that the navigation
                  tree should be displayed everywhere including pages in the
                  root of the site. 1 means the tree should be displayed 
                  with content contained inside folders in the site root and 
                  below.
                </div>
                <input name="topLevel"
                       type="text"
                       size="4"
                       tal:attributes="value value;"/>
                <div tal:content="error">Validation error output</div>
              </div>
              <div class="field"
                tal:define="
                  value python:navtree_props.getProperty('bottomLevel');
                  value request/bottomLevel|value;
                  error errors/bottomLevel|nothing"
                tal:attributes="class python:error and 'field error' or 'field';">
                <label>Navigation tree depth</label>
                <span class="fieldRequired" title="Required"
                  i18n:attributes="title title_required;"
                  i18n:translate="label_required">(Required)
                </span>
                <div class="formHelp">
                  An integer value that specifies the number of folder levels
                  below the root that should be included in the tree structure 
                  of the navigation tree.  0 means no limit.  1 means only 
                  include the root folder.
                </div>
                <input name="bottomLevel"
                       type="text"
                       size="30"
                       tal:attributes="value value;"/>
                <div tal:content="error">Validation error output</div>
              </div>


            <div class="field" id="navigationtypes-field"
                 tal:define="
                       portal_types     portal/portal_types;
                       allTypes         python:[portal_types.getTypeInfo(t) for t in here.getPortalTypes()];
                       typeLists        python:here.createMultiColumnList(allTypes, numCols=3, sort_on='title_or_id');
                       blacklisted      navtree_props/metaTypesNotToList;
                       searchTypes      python:[t.getId() for t in allTypes if t.getId() not in blacklisted];">

                <label i18n:translate="label_navigation_types">Displayed content types</label>

                <div class="formHelp" id="navigationtypes_help"
                     i18n:translate="help_navigationtypes">
                     The content types that should be shown in the navigation tree and the site map.
                </div>

                <div style="float:left; margin-right: 2em; width: 29%" tal:repeat="sublist typeLists">
                   <ul class="configlets">
                     <li tal:repeat="ptypeInfo sublist">
                       <input class="noborder"
                           type="checkbox"
                           name="portaltypes:list"
                           tal:attributes="value ptypeInfo/getId;
                                           id python:normalizeString(ptypeInfo.getId());
                                           checked python:test(ptypeInfo.getId() in searchTypes,'checked','');" />
                       <label for=""
                           i18n:translate=""
                           tal:attributes="for python:normalizeString(ptypeInfo.getId())"
                           tal:content="ptypeInfo/Title"
                           />
                    </li>
                   </ul>
                </div>
            </div>

            <div class="visualClear"><!-- --></div>

            <div class="field" id="navigationstates-field"
                 tal:define="
                       states          python:wtool.listWFStatesByTitle(filter_similar=1);
                       state_lists     python: here.createMultiColumnList(states, numCols=1, sort_on='self');
                       cur_list        navtree_props/wf_states_to_show;">

                <fieldset id="navtree_wf_filter">
                    <legend>
                        <input class="noborder"
                               type="checkbox"
                               name="enable_wf_state_filtering"
                               id="enable-wf-state-filtering"
                               tal:attributes="checked navtree_props/enable_wf_state_filtering;" />
                        <label for="enable-wf-state-filtering"
                               style="font-size: 110%"
                               i18n:translate="label_navtree_wf_enable">Filter on workflow state</label>
                    </legend>

                    <div class="formHelp"
                             i18n:translate="help_wf_states">
                        The workflow states that should be shown in the navigation tree and the site map.
                    </div>

                    <tal:states repeat="sublist state_lists">
                    <ul class="configlets">
                        <li tal:repeat="state sublist">
                            <input class="noborder"
                                   type="checkbox"
                                   name="wf_states_to_show:list"
                                   tal:attributes="value python:state[1];
                                                   id python:normalizeString(state[1]);
                                                   checked python:test(state[1] in cur_list,'checked','');" />
                            <label for=""
                                   i18n:translate=""
                                   tal:attributes="for python:normalizeString(state[1])"
                                   tal:content="python:state[0] or state[1]"
                                   />
                        </li>
                    </ul>
                    </tal:states>
            </fieldset>

            </div>

            <div class="visualClear"><!-- --></div>

            <div class="formControls">
                <input class="context"
                       tabindex=""
                       type="submit"
                       name="form.button.Save"
                       value="Save"
                       i18n:attributes="value label_save;"
                       tal:attributes="tabindex tabindex/next;"
                       />
            </div>

        </fieldset>

        <input type="hidden" name="form.submitted" value="1" />

    </form>

</div>

</body>
</html>


