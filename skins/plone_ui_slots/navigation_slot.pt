<table metal:define-macro="navigationBox"
       tal:define="isContainer here/isPrincipiaFolderish|nothing;
                   parent_url python:here.navigationParent(here, template.getId());
                   siblings here/navigationCurrent;
                   showOtherNav python:0;
                   showNav python:0;"
       tal:condition="parent_url"
       class="box"
       summary="Navigation"
       cellpadding="0"
       cellspacing="0">

    <thead>
        <tr><th>Navigation</th><th class="empty">&nbsp;</th></tr>
    </thead>

    <tbody tal:define="listContentsPermission python:here.portal_membership.checkPermission('List folder contents', here);
                       notFolderContents python:test(template.getId()!='folder_contents', 1, 0);">
        <tr class="odd">
            <td colspan="2">
            <strong tal:content="here/title_or_id">Current title</strong>
            </td>
        </tr>

        <tr class="even" tal:condition="siblings">
            <td colspan="2">
            <div>
                <strong>Other items</strong>
                <span tal:repeat="sibling siblings">
                    <a href="#" class="plain"
                     tal:define="actions python:here.portal_actions.listFilteredActionsFor(sibling);
                     action python:here.getActionUrlById('view', actions['object']);
                     url python:test(action, action,sibling.absolute_url()+'/folder_contents');"
                     tal:attributes="href url">
		         <img src="" 
			      height="16" 
			      width="16" 
			      tal:attributes="src sibling/getIcon" /> &nbsp;
			          <span tal:replace="python:here.truncID(sibling.title_or_id(), 10)"/>
		    </a>
                </span>
            </div>
            </td>
        </tr>

        <tr class="odd" tal:condition="parent_url">
            <td colspan="2">
                <a href="" tal:attributes="href parent_url">Up one level</a>
            </td>
        </tr>

        <tr class="even"
            tal:condition="python:test(listContentsPermission and notFolderContents, 1, 0)">
            <td colspan="2"
                tal:condition="notFolderContents">
                <a href="folder_contents">Editor view</a>
            </td>
        </tr>

        <tr class="even"
            tal:condition="not: notFolderContents">
            <td colspan="2" >
                <a href="">Ordinary view</a>
            </td>
        </tr>

    </tbody>

</table>

<!-- CMFTopic based navigation box -->
<table class="box" summary="Navigation listing" cellpadding="0" cellspacing="0"
       metal:define-macro="CMFTopic_navigation_box"
       tal:define="results python:here.portal_catalog(meta_type='Portal Topic',sort_on='id');
                   pss modules/Products/PythonScripts/standard;
                   showNav python:1;"
       tal:condition="python:test(results and here.meta_type!='Portal Topic' and showNav, 1, 0)">

       <!-- We don't show this box when we are editing a Portal Topic
            This is because it would lead to infinate recursion -->

  <span tal:replace="results" />
  <span tal:define="navExpand python:request.SESSION.get('navExpand', results[0].Title)">
   <tr><th>navigation</th><th class="empty">&nbsp;</th></tr>
   <span tal:repeat="topic results">
    <tr>
      <td nowrap colspan="2">
        <a href="#" 
	   class="plain" 
	   tal:attributes="href python:here.navigatorExpand.absolute_url()+'?topic='+pss.url_quote(topic.Title)"
           tal:content="topic/Title">
	I am a navigation box
	</a>
        <span tal:define="obj python:topic.getObject()">
        <span tal:omit-tag="" 
	      tal:repeat="item python:obj.queryCatalog()"
              tal:condition="obj">
          <span tal:omit-tag="" 
	        tal:condition="python:item.Title and navExpand==topic.Title">
            <br />
            <a href="#" tal:attributes="href python:item.getObject().absolute_url()"
                        tal:content="item/Title">&nbsp;</a>
          </span>
        </span>
        </span>
      </td>
    </tr>
   </span>
  </span>
</table>
