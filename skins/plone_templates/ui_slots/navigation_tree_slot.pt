<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">

<body>

<div metal:define-macro="navigationBox"
       i18n:domain="plone"
       tal:omit-tag=""
       tal:define="isContainer here/isPrincipiaFolderish|nothing;
                   navBatchStart request/navBatchStart | python:None;
                   portalObject here/portal_url/getPortalObject;
                   tree python:here.plone_utils.createNavigationTreeBuilder(portalObject,navBatchStart);
                   showOtherNav python:0;
                   showNav python:0;
                   checkPerm python:here.portal_membership.checkPermission;
                   listContentsPermission python:checkPerm('List folder contents', here);
                   notFolderContents python:test(template.getId()!='folder_contents', 1, 0);
                   editorView python:test(listContentsPermission and notFolderContents, 1, 0);
                   croppingLength here/navtree_properties/croppingLength | here/portal_properties/navtree_properties/croppingLength | python:18;
                   rolesSeeContentsView here/navtree_properties/rolesSeeContentsView | here/portal_properties/navtree_properties/rolesSeeContentsView | python:['Manager','Reviewer','Owner'];
                   useFolderContents here/portal_properties/use_folder_contents | python:['Folder']
                   "

                   >

    <div class="box">

        <h5 i18n:translate="box_navigation">Navigation</h5>

        <div class="body">
            <div class="content odd">
                     
                <div tal:condition="tree/prev">
                    <a tal:attributes="href string:${request/URL}?navBatchStart=${tree/prevBatchStart}">
                        <span i18n:translate="">...</span>
                    </a>
                </div>
                
                <div style="white-space: nowrap;"
                     tal:repeat="te tree/list">
            
                    <span tal:define="iscurrent te/iscurrent | python:0;
                                      sibling python:te['object'];
                                      typeInfo sibling/getTypeInfo;
                                      stdCommand python:test(not notFolderContents,'folder_contents',test(typeInfo.id in useFolderContents,'',typeInfo.immediate_view));
                                      stdCommand python:test(stdCommand in ('folder_contents','folder_listing'),test(checkPerm('List folder contents',sibling) ,stdCommand,''),typeInfo.immediate_view);
                                      title python:te['object'].title_or_id();
                                      sibling_title python:' '.join(title[:croppingLength].split(' '));"
                                      rtal:on-error="structure string:<!--Error in Navigation loop!!-->"
                                           >
                               
                        <tal:block repeat="x python:range( te['indent'])">&nbsp;</tal:block>

                        <tal:block tal:condition="iscurrent">
                           <span class="currentNavItem">
                        </tal:block>
                        <a href="" 
                           tal:condition="python: sibling != portalObject"
                           tal:define="url string:${sibling/absolute_url}/${stdCommand}"
                           tal:attributes="href url;
                                           title python:test(title != sibling_title, title, '');"
                           class="plain">
                
                            <img tal:replace="structure python:path('here/%s' % sibling.getIcon(1))" 
                                 tal:on-error="structure here/site_icon.gif"
                                    />&nbsp;<tal:block tal:condition="not: iscurrent" tal:content="structure sibling_title" /><span class="currentNavItem" tal:condition=" iscurrent" tal:content="structure sibling_title" />
                        </a>
                        
                        <a href="" 
                           tal:condition="python: sibling == portalObject"
                           tal:define="url string:${sibling/absolute_url}/${stdCommand}"
                           tal:attributes="href url;
                                           title python:test(title != sibling_title, title, '');">
                           
                            <img tal:replace="structure portal/site_icon.gif" />&nbsp;<tal:block tal:condition="not: iscurrent" tal:content="structure sibling_title" /><span class="currentNavItem" tal:condition=" iscurrent" tal:content="structure sibling_title" />
                        </a>
                    </span>
                </div>
                <div tal:condition="tree/next">
                    <a tal:attributes="href string:${request/URL}?navBatchStart=${tree/nextBatchStart}">
                        <span i18n:translate="">...</span>
                    </a>
                </div>
    
            </div>

        </div>

    </div>

</div>
    
</body>

</html>

