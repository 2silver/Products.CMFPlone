<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      i18n:domain="plone">

<body>

<div metal:define-macro="navigationBox"
       i18n:domain="plone"
       tal:omit-tag=""
       tal:define="isContainer here/isPrincipiaFolderish|nothing;
                   navBatchStart request/navBatchStart | python:None;
                   tree python:here.navigation_tree_builder(root,navBatchStart);
                   showOtherNav python:0;
                   showNav python:0;
                   listContentsPermission python:here.portal_membership.checkPermission('List folder contents', here);
                   notFolderContents python:test(template.getId()!='folder_contents', 1, 0);
                   editorView python:test(listContentsPermission and notFolderContents, 1, 0);
                   croppingLength here/navtree_properties/croppingLength | here/portal_properties/navtree_properties/croppingLength | python:18;
                   rolesSeeContentsView here/navtree_properties/rolesSeeContentsView | here/portal_properties/navtree_properties/rolesSeeContentsView | python:['manager','Reviewer','Owner']
                   "
                   tal:on-error="structure string:<!--Error in Navigation!!-->"
                   >

    <span class="boxTitle" i18n:translate="">Navigation</span>

    <div class="box">

        <tal:block tal:condition="python:request['AUTHENTICATED_USER'].has_role(rolesSeeContentsView, here)">
            <div class="content odd"
                 tal:condition="editorView">
            
                <div tal:condition="notFolderContents">
                
                    <a href="folder_contents"
                       tal:condition="here/isPrincipiaFolderish">
                    
                        <img tal:replace="structure here/linkTransparent.gif" />
                        
                        <span i18n:translate="box_contents_view">Switch to Contents view</span>
                    </a>
                           
                    <a href="../folder_contents"
                       tal:condition="not: here/isPrincipiaFolderish" 
                       tal:attributes="href string:${here/aq_parent/absolute_url}/folder_contents"
                       tal:on-error="structure string:aq_parent not allowed!"
                       >
            
                        <img tal:replace="structure here/linkTransparent.gif" />
                
                        <span i18n:translate="box_contents_view">Switch to Contents view</span>
                    </a>
                </div>
            </div>
        </tal:block>

        <div class="content odd"
             tal:condition="not: notFolderContents">
            <a href="">
                
                <img tal:replace="structure here/linkTransparent.gif" />
                
                <span i18n:translate="box_item_view">Switch to Item view</span>
            </a>
        </div>

        <div class="content even">
                 
            <div tal:condition="tree/prev">
                <a tal:attributes="href string:${request/URL}?navBatchStart=${tree/prevBatchStart}">
                    <span i18n:translate="">...</span>
                </a>
            </div>
            
            <div style="white-space: nowrap;"
                 tal:repeat="te tree/list">
        
                <tal:block tal:define="iscurrent te/iscurrent | python:0;
                                       sibling python:te['object'];
                                       stdCommand python:test(template.getId()=='folder_contents' and  
                                           sibling.isPrincipiaFolderish , 'folder_contents', 
                                               test(sibling.isPrincipiaFolderish,'','view'));
                                           
                                       
                                       title python:te['object'].title_or_id();
                                       sibling_title python:'&nbsp;;'.join(title[:croppingLength].split(' '));"
                                       tal:on-error="structure string:<!--Error in Navigation loop!!-->"
                                       >
                           
                    <span tal:repeat="x python:range( te['indent'])" tal:omit-tag="">&nbsp;</span>
                    <tal:block tal:condition="iscurrent">
                       <strong>
                    </tal:block>
                    <a href="" 
                       tal:condition="python: sibling.meta_type != 'CMF Site'"
                       tal:define="url string:${sibling/absolute_url}/${stdCommand}"
                       tal:attributes="href url;
                                       title python:test(title != sibling_title, title, '');"
                       class="plain">
            
                        <img tal:replace="structure python:path('here/%s' % sibling.getIcon(1))" 
                             tal:on-error="structure here/site_icon.gif"
                                />
                        
                        <tal:block tal:condition="not: iscurrent" tal:content="structure sibling_title" />
                        <strong tal:condition=" iscurrent" tal:content="structure sibling_title" />
                    </a>
                    
                    <a href="" 
                       tal:condition="python: sibling.meta_type == 'CMF Site'"
                       tal:define="url string:${sibling/absolute_url}"
                       tal:attributes="href url;
                                       title python:test(title != sibling_title, title, '');">
                       
                        <img tal:replace="structure here/site_icon.gif" />
                        <tal:block tal:condition="not: iscurrent" tal:content="structure sibling_title" />
                        <strong tal:condition=" iscurrent" tal:content="structure sibling_title" />
                    </a>

                </tal:block>
            </div>
            <div tal:condition="tree/next">
                <a tal:attributes="href string:${request/URL}?navBatchStart=${tree/nextBatchStart}">
                    <span i18n:translate="">...</span>
                </a>
            </div>
    
        </div>

    </div>

</div>
    
</body>

</html>

