<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      i18n:domain="plone">

<body>

<metal:menubarmacro define-macro="contentMenu">

<ul tal:define="contentTypes allowed_types;
        filterOut here/getNotAddableTypes;
		size python:len(contentTypes);">

    <tal:states define="review_state wf_state;
                        transitions workflow_actions;"
                condition="python:review_state">

    <li tal:condition="not: transitions"
        class="actionSingular">
        <tal:state i18n:translate="label_state">State</tal:state>:
        <span tal:content="review_state"
              tal:attributes="class string:state-${review_state}"
              i18n:translate="">
        Workflow state
        </span>
    </li>


    <li class="actionPlural" tal:condition="transitions">

        <div class="menuPosition">
            <ul class="actionMenu"
                id="statusMenu"
                onmouseover="menuMouseover(event)">  
                <tal:block repeat="transition transitions">
                <li>
                    <a href="#"
                       onMouseUp="if (activeButton != null) resetButton(activeButton);" 
                       i18n:translate=""
                       tal:content="transition/name"
                       i18n:attributes="title"
                       tal:attributes="href string:$here_url/content_status_modify?workflow_action=${transition/id};
                                       title transition/name">File Menu Item 1</a>
                </li>
                </tal:block>
                <li class="actionSeperator">
                    <a href="#" 
                       tal:attributes="href string:$here_url/content_status_history"
                       i18n:translate="label_advanced">Advanced</a>
                </li>
            </ul>
    
             <a href="#"
                onclick="return buttonClick(event, 'statusMenu');"
                onmouseover="buttonMouseover(event, 'statusMenu');">
    
                <span i18n:translate="label_state">State</span>:
        
                <span tal:content="review_state"
                         tal:attributes="class string:state-${review_state}"
                         i18n:translate="">
                Workflow state
                </span>
            </a>
        </div>

    </li>
    
    </tal:states>

    <tal:dropdown tal:condition="python: size>1">

    <li>
        <div class="menuPosition">
            <a href="#"
               title="Add new items to this folder"
               onclick="return buttonClick(event, 'objectMenu');"
               onmouseover="buttonMouseover(event, 'objectMenu');"
               i18n:attributes="title">
               <span i18n:translate="label_add_new_item">Add New Item</span></a>
    
            <ul class="actionMenu" id="objectMenu"
                onmouseover="menuMouseover(event)">
                <metal:block tal:repeat="ctype contentTypes"> 
                <li tal:define="Title ctype/Title;Id ctype/getId">
                    <a href="#" 
                       onMouseUp="if (activeButton != null) resetButton(activeButton);"
                       tal:define="folder python:test(getattr(here.aq_explicit, 'isPrincipiaFolderish', 0), here, here.getParentNode())"
                       i18n:attributes="title"
                       tal:attributes="href python:folder.absolute_url()+'/createObject?type_name='+Id;
                                       title Title">
                      <img src="folder.gif" 
                           alt="" 
                           width="16" 
                           height="16" 
                           tal:attributes="src string:$portal_url/${ctype/getIcon}" />
                      <tal:title i18n:translate=""
                                 tal:content="Title">Title</tal:title>
                    </a>
                </li>
                </metal:block>
            </ul>
        </div>
    </li>
    </tal:dropdown>

    <li tal:condition="python: size==1 and allowedSortedContentTypes[0].getId() not in filterOut"
        class="actionSingular">
        <a href="#" 
           tal:define="portaltype python: contentTypes[0];
                       folder python:test(getattr(here.aq_explicit, 'isPrincipiaFolderish', 0), here, here.getParentNode());"
           tal:attributes="href string:${folder/absolute_url}/createObject?type_name=${portaltype/getId}"
           >
            <img src="folder.gif" 
                 alt="" 
                 width="16" 
                 height="16" 
                 tal:attributes="src string:$portal_url/${portaltype/getIcon}"/>
            <span tal:define="ttype python:here.translate(portaltype.Title())"
                  tal:replace="python:here.translate('Add ${type}', {'type':ttype})" />
        </a>
    </li>

    <tal:templateMixin define="iface_tool portal/portal_interface;
                               isTemplateMixin python:iface_tool.objectImplements(here, 'Products.Archetypes.interfaces.ITemplateMixin.ITemplateMixin');
                               field python:here.getField('layout');
                               vocab python:field.Vocabulary(here);"
         condition="python:isTemplateMixin and len(vocab) > 1">
    <li>
    <b tal:content="vocab"/>
        <div class="menuPosition">
            <a href="#"
               title="Choose default view"
               onclick="return buttonClick(event, 'templateMenu');"
               onmouseover="buttonMouseover(event, 'templateMenu');"
               i18n:attributes="title">
               <span i18n:translate="label_choose_template">Display</span></a>

            <ul class="actionMenu" id="templateMenu"
                onmouseover="menuMouseover(event)"
                tal:define="check string:&bull;;">

              <tal:block repeat="item vocab">
                <li tal:define="value item;
                                display python:here.translate(vocab.getMsgId(value), default=vocab.getValue(value));">
                                
                    <a href="#" 
                       onMouseUp="if (activeButton != null) resetButton(activeButton);"
                       tal:define="folder python:test(getattr(here.aq_explicit, 'isPrincipiaFolderish', 0), here, here.getParentNode())"
                       i18n:attributes="title"
                       tal:attributes="href python:here.absolute_url()+'/selectViewTemplate?templateId='+value;
                                       title display">
                        <span tal:replace="structure check"/>
                        <tal:title i18n:translate=""
                                   tal:content="display">Template id</tal:title>
                    </a>
                </li>
              </tal:block>
            </ul>
        </div>
    </li>
    </tal:templateMixin>

</ul>

</metal:menubarmacro>
</body>
</html>

