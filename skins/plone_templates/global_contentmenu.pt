<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"
      i18n:domain="plone">

<body>

<metal:menubarmacro define-macro="contentMenu">

<ul tal:define="size python:len(allowedSortedContentTypes);">

    <tal:dropdown tal:condition="python: size>1">

    <li>
        <a href="#"
           onclick="return buttonClick(event, 'objectMenu');"
           onmouseover="buttonMouseover(event, 'objectMenu');"
           i18n:translate="label_add_new_item">Add New Item</a>

        <ul class="actionMenu" id="objectMenu"
            onmouseover="menuMouseover(event)"
            tal:define="filterOut here/getNotAddableTypes;">
            <metal:block tal:repeat="ctype allowedSortedContentTypes"> 
            <li tal:define="Title ctype/Title;Id ctype/getId"
                tal:condition="python:test(Id not in filterOut, 1, 0)">
                <a href="#" 
                   onMouseUp="if (activeButton != null) resetButton(activeButton);"
                   tal:define="folder python:test(getattr(here.aq_explicit, 'isPrincipiaFolderish', 0), here, here.getParentNode())"
                   tal:attributes="href python:folder.absolute_url()+'/createObject?type_name='+Id">
                  <img src="folder.gif" 
                       alt="" 
                       width="16" 
                       height="16" 
                       tal:attributes="src string:$portal_url/${ctype/getIcon}" />
                  <tal:title i18n:translate=""
                             tal:content="ctype/Title">Title</tal:title>
                </a>
            </li>
            </metal:block>
        </ul>
    </li>
    </tal:dropdown>

    <li tal:condition="python: size==1"
        class="actionSingular">
        <a href="#" 
           tal:define="portaltype python: allowed[0];
                       folder python:test(getattr(here.aq_explicit, 'isPrincipiaFolderish', 0), here, here.getParentNode());"
           tal:attributes="href string:${folder/absolute_url}/createObject?type_name=${portaltype/getId}"
           >
            <img src="folder.gif" 
                 alt="" 
                 width="16" 
                 height="16" 
                 tal:attributes="src string:$portal_url/${portaltype/getIcon}" />
            Add new
            <tal:title i18n:translate=""
                       tal:content="portaltype/Title">Title</tal:title>
        </a>
    </li>

    <li tal:define="review_state wf_state"
        tal:condition="review_state">

        <span i18n:translate="label_state">State</span>:
        
        <a href="#"
           onclick="return buttonClick(event, 'statusMenu');"
           onmouseover="buttonMouseover(event, 'statusMenu');">

           <span tal:content="review_state"
                 tal:attributes="class string:state-${review_state}"
                 i18n:translate="">
            Workflow state
           </span>

       </a>

        <ul class="actionMenu"
            id="statusMenu"
            onmouseover="menuMouseover(event)"
            tal:define="global transitions python:wtool.getTransitionsFor(here, here)"
            tal:condition="transitions">  
            <tal:block repeat="transition transitions">
            <li>
                <a href="#"
                   onMouseUp="if (activeButton != null) resetButton(activeButton);" 
                   i18n:translate=""
                   tal:content="transition/name"
                   tal:attributes="href string:${here/absolute_url}/content_status_modify?workflow_action=${transition/id}">File Menu Item 1</a>
            </li>
            </tal:block>
            <li class="actionSeperator">
                <a href="#" 
                   tal:attributes="href string:${here/absolute_url}/content_status_history"
                   i18n:translate="label_advanced">Advanced</a>
            </li>
        </ul>
    </li>
</ul>

</metal:menubarmacro>
</body>
</html>
