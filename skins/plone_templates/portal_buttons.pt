<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<div metal:define-macro="discussionView"
     tal:define="actions python:request.get('filtered_actions', here.portal_actions.listFilteredActionsFor(here));
                 isDiscussionAllowed python:request.get('discussion_allowed', container.portal_discussion.isDiscussionAllowedFor(here));
		 hereTypeInfo python:request.get('this_typeinfo', here.getTypeInfo());
		 view_action python:hereTypeInfo.getActionById('view');
		 reply python:[oa for oa in actions['object'] if oa.get('id', '')=='reply'];
		 isViewTemplate python:test(template.getId()==view_action, 1, 0);"
     tal:condition="python:test( isDiscussionAllowed and isViewTemplate , 1, 0) ">	

    <form name="reply" 
          action="" 
          method="post"
          tal:condition="reply" 
	  tal:attributes="action python:reply[0]['url']">       	

        <tal tal:define="discussion python:here.portal_discussion.getDiscussionFor(here)" />
	
        <input class="standalone" 
	       type="submit" 
	       value="Add Comment" />
    </form>
    
    <div class="spacer">
    &nbsp;
    </div>

    <div>
        <span tal:replace="structure here/viewThreadsAtBottom|nothing"> 
           tree-view of threaded discussion is here
         </span>
    </div>


</div>
        
