<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      i18n:domain="plone"
      metal:use-macro="here/main_template/macros/master">

  <head>
      <metal:block fill-slot="top_slot">
        <span tal:replace="nothing"
              tal:define="dummy python:request.set('enable_border', 1)" />
      </metal:block>
  </head>

  <body>

    <div metal:fill-slot="main">
    <metal:contentsmacro define-macro="contents"
         tal:define="standalone python:1;
                     contentTypes here/getAllowedTypes;
                     contentFilter contentFilter|request/contentFilter|nothing;
                     view_title view_title|request/view_title|nothing;
                     contents python: here.getFolderContents(contentFilter=contentFilter);
                     full_view full_view|request/full_view|python:True;">
      
      <form name="folderContentsForm"
            method="post"
            action="folder_object"
            tal:attributes="action here_url">

        <h1>
          <tal:block replace="structure python:getattr(here, here.getIcon(1))"/>
          <span tal:content="python: view_title or here.title_or_id()" tal:omit-tag="">Directory Id</span>
        </h1>
        <tal:full_view condition="full_view">
            <div metal:use-macro="here/document_actions/macros/document_actions">
                Document actions (print, sendto etc)
            </div>
    
            <a href=""
               class="link-parent"
               tal:define="parent_url python:here.navigationParent(here, template.getId())"
               tal:condition="parent_url"
               tal:attributes="href parent_url"
               i18n:translate="go_to_parent_url">
                Up one level
            </a>
    
            <p tal:content="here/Description">
                Description
            </p>
        </tal:full_view>

        <p tal:condition="not: contents"
           i18n:translate="description_no_visible_items_add_paste">
           This folder has no visible items. To add content, press the
           add button, or paste content from another location.
        </p>
        <metal:override define-slot="override_slot">
           <tal:comment replace="nothing">
              Slot for overiding batching mechanism including batch size and
              other parameters
           </tal:comment>
        </metal:override>
        <metal:listing define-macro="folder_listing"
                       tal:define="b_size batch_size | request/batch_size | python:100;
                                   contentFilter contentFilter|nothing;
                                   b_start b_start|request/b_start|python:0;
                                   Batch python:modules['Products.CMFPlone'].Batch;
                                   batch batch|contents;
                                   batch python: (same_type(batch, Batch([],0)) and batch) or Batch(batch, b_size, int(b_start), orphan=0);
                                   isExpired nocall:portal/isExpired;
                                   iface_tool portal/portal_interface;
                                   use_folder_contents site_properties/typesLinkToFolderContentsInFC | python:['Folder','Large Plone Folder'];
                                   orderable_iface string:OFS.IOrderSupport.IOrderedContainer;
                                   preSorted python:(contentFilter and contentFilter.get('sort_on', 'getObjPositionInParent')!='getObjPositionInParent') or (not contentFilter and request.get('sort_on', 'getObjPositionInParent')!='getObjPositionInParent');
                                   isOrderable python:iface_tool.objectImplements(here, orderable_iface);
                                   nosortclass python:test(isOrderable, 'nosort', '');
                                   canModifyFolderContent python:checkPermission('Modify portal content', here);">
          <div tal:condition="standalone|nothing">
          <metal:add_button define-macro="add_button"
                            tal:define="num_types python:len(contentTypes);">
            <!-- Add Item pulldown -->
            <label for="select_add_item">
              <span class="hiddenLabel" i18n:translate="label_add_item">Select an item to add</span>
            </label>

            <select id="select_add_item"
                    name="type_name"
                    tabindex=""
                    tal:condition="python: num_types > 1"
                    tal:attributes="tabindex tabindex/next|nothing">

              <option value="Select" i18n:translate="label_select">Select</option>
              <metal:types tal:repeat="ctype contentTypes">
                <option value="Document"
                        tal:define="Id ctype/getId"
                        tal:attributes="value ctype/getId"
                        tal:content="ctype/Title"
                        i18n:translate="">Document</option>
              </metal:types>
            </select>

            <input type="hidden"
                   name="type_name"
                   value="Content Type Id"
                   tal:condition="python: num_types==1"
                   tal:attributes="value python:contentTypes[0].getId()" />

            <input class="standalone"
                   type="submit"
                   name="folder_factories:method"
                   value="Add New Item"
                   tabindex=""
                   tal:define="ttype python: num_types==1 and here.translate(contentTypes[0].Title())"
                   tal:condition="python: num_types"
                   tal:attributes="tabindex tabindex/next|nothing;
                                   value python:ttype and here.translate('Add ${type}', {'type': ttype}) or
                                                          here.translate('label_add_new_item', default='Add New Item')" />
          </metal:add_button>
          </div>

        <!-- Navigation -->
        <div metal:use-macro="here/batch_macros/macros/navigation" />
          <table id="sortable"
                 class="listing"
                 summary="Content listing"
                 cellpadding="0" cellspacing="0">
            <thead>
              <metal:block tal:condition="batch|not:standalone|nothing">
                <tr>
                  <th class="nosort">
                      <input class="noborder"
                             type="checkbox"
                             src="select_all_icon.gif"
                             name="selectButton"
                             title="Select all items"
                             onClick="toggleSelect(this);"
                             tal:attributes="src string:$portal_url/select_all_icon.gif"
                             alt="Select all items"
                             i18n:attributes="title alt"
                  />
                  </th>
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:title i18n:translate="listingheader_title"
                      >Title</tal:title>&nbsp;</th>
                  <metal:header_slot metal:define-slot="listingheader">
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:size i18n:translate="listingheader_size"
                      >Size</tal:size>&nbsp;</th>
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:modified i18n:translate="listingheader_modified"
                      >Modified</tal:modified>&nbsp;</th>
                  <th tal:attributes="class python:nosortclass"
                      >&nbsp;<tal:state i18n:translate="listingheader_status"
                      >State</tal:state>&nbsp;</th>
                  <th class="nosort"
                      tal:condition="python:isOrderable and canModifyFolderContent and not preSorted"
                      >&nbsp;<tal:order i18n:translate="listingheader_order"
                      >Order</tal:order>&nbsp;</th>
                  </metal:header_slot>
                </tr>
              </metal:block>
            </thead>

            <metal:block tal:condition="batch|not:standalone|nothing">
            <tbody tal:define="arrowUp portal/arrowUp.gif;
                               arrowDown portal/arrowDown.gif;
                               getRelativeContentURL nocall:utool/getRelativeContentURL
                               ">
                <tal:items tal:repeat="item batch">
                   <tr tal:define="oddrow repeat/item/odd;
                                   getInfoFor python:wtool.getInfoFor;
                                   item_url item/getURL|item/absolute_url;
                                   item_id item/getId;
                                   item_title_or_id python: (same_type(item.getId,'') and (item.Title or '[...]')) or item.title_or_id();
                                   item_description item/Description;
                                   item_type item/portal_type;
                                   item_typeinfo python: here.portal_types.getTypeInfo(item_type);
                                   item_size item/getObjSize;
                                   item_modified item/ModificationDate;
                                   item_wf_state item/review_state|python: getInfoFor(item, 'review_state', '');
                                   item_wf_state_class python:here.getStateClassName(item_wf_state);
                                   item_icon python:portal_url+'/'+ item_typeinfo.getIcon();
                                   hasGetUrl python:hasattr(item.aq_explicit, 'getURL');
                                   item_rel_url python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);
                                   browserDefaultResult here/browserDefault;
                                   isBrowserDefault python:len(browserDefaultResult[1]) == 1 and item.id == here.browserDefault()[1][0]"
                       tal:attributes="class python:test(oddrow, 'even', 'odd')" >

                       <tal:comment replace="nothing">
                            * We have to check if the browserDefault stuff is really necessary
                            * Create title_or_id metadata in the catalog (why not just use item.Title or item.getId? (alecm))
                       </tal:comment>

                       <td>
                           <input type="checkbox"
                                  class="noborder"
                                  name="ids:list" id="#"
                                  value="#"
                                  tal:attributes="value item_id;
                                                  id string:cb_$item_id;
                                                  checked request/ids_checked|nothing;
                                                  alt string:Select $item_title_or_id;
                                                  title string:Select $item_title_or_id"/>
                      <input type="hidden" name="obj_paths:list" value="#"
                             tal:attributes="value item_rel_url" />

                    </td>
                    <td tal:define="action python:item_typeinfo.getActionById('view');
                                    url python:test(item_typeinfo.getId() in use_folder_contents,
                                    item_url+'/folder_contents',
                                    item_url+'/'+action);">
                      <a href="#" tal:attributes="href item_url;
                                                  title item_description;">
                          <img alt="" tal:attributes="src item_icon;
                                               title item_type;"
                               i18n:attributes="title"/>
                            <strong tal:omit-tag="python:not isBrowserDefault">
                            <span tal:content="item_title_or_id"
                                  tal:attributes="class item_wf_state_class">Title</span></strong>
                      </a>

                      <span class="state-expired"
                            tal:condition="python:isExpired(item)"
                            i18n:translate="time_expired">expired</span>
                    </td>

                    <metal:item_slot metal:define-slot="item_display">
                    <td>
                      <span tal:condition="not: item_size"> &nbsp; </span>
                      <span tal:condition="python:item_size>0"
                            tal:content="item_size"
                            tal:attributes="class item_wf_state_class"> size </span>
                    </td>
                    <td tal:content="item_modified"
                        tal:attributes="class item_wf_state_class">
                        08/19/2001 03:01 AM
                    </td>
                    <td>
                        <span i18n:translate=""
                              tal:condition="item_wf_state"
                              tal:content="item_wf_state"
                              tal:attributes="class item_wf_state_class" />
                        <span tal:condition="not: item_wf_state">&nbsp;</span>
                    </td>
                    <td tal:condition="python:isOrderable and canModifyFolderContent and not preSorted">
                      <a href=""
                         title="Move item up"
                         i18n:attributes="title"
                         tal:attributes="href string:$here_url/folder_position?position=up&amp;id=$item_id">
                         <img tal:replace="structure arrowUp" />
                      </a>
                      &nbsp;
                      <a href=""
                         title="Move item down"
                         i18n:attributes="title"
                         tal:attributes="href string:$here_url/folder_position?position=down&amp;id=$item_id">
                         <img tal:replace="structure arrowDown" />
                      </a>
                    </td>
                    </metal:item_slot>
                   </tr>
                </tal:items>
            </tbody>
            </metal:block>
            </table>
            <!-- Navigation -->
            <div metal:use-macro="here/batch_macros/macros/navigation" />
        </metal:listing>

        <tal:buttons tal:repeat="button actions/folder_buttons|nothing">
          <input class="context"
                 type="submit"
                 name=""
                 value=""
                 tabindex=""
                 tal:condition="python:contents or here.cb_dataValid and button['id'] == 'paste'"
                 i18n:attributes="value"
                 tal:attributes="value button/name;
                                 name button/url;
                                 tabindex tabindex/next;
                                 class python:test((button['id'] == 'paste'), 'standalone', 'context')" />
        </tal:buttons>
      </form>

    </metal:contentsmacro>
    </div>


  </body>
</html>
